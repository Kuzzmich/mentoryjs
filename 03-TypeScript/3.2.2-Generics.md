# 3.2.2 Generics

Generics (–æ–±–æ–±—â—ë–Ω–Ω—ã–µ —Ç–∏–ø—ã) –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ª—é–±—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, —Å–æ—Ö—Ä–∞–Ω—è—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. –≠—Ç–æ –æ–¥–∏–Ω –∏–∑ –º–æ—â–Ω–µ–π—à–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ TypeScript –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –≥–∏–±–∫–æ–≥–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –∫–æ–¥–∞.

---

## üéØ –ß—Ç–æ —Ç—ã —É–∑–Ω–∞–µ—à—å

- –ß—Ç–æ —Ç–∞–∫–æ–µ Generics –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã
- Generic-—Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ç–∏–ø–∞
- Generic-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∫–ª–∞—Å—Å—ã
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ `extends`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `keyof` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª—é—á–µ–π
- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–∏–ø–∞ (`<T, K>`)
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è generic-—Ç–∏–ø–æ–≤
- –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Generics, –∞ –∫–æ–≥–¥–∞ –Ω–µ—Ç

---

## üìñ –¢–µ–æ—Ä–∏—è

### –ß—Ç–æ —Ç–∞–∫–æ–µ Generics?

**Generics (–æ–±–æ–±—â—ë–Ω–Ω—ã–µ —Ç–∏–ø—ã)** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å **–ª—é–±—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö**, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º **—Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∞:

```typescript
function identity(value: any): any {
  return value;
}

const result = identity("Hello"); // result: any üò¢
```

–ü—Ä–æ–±–ª–µ–º–∞: –º—ã **–ø–æ—Ç–µ—Ä—è–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ**. `result` –∏–º–µ–µ—Ç —Ç–∏–ø `any`, —Ö–æ—Ç—è –º—ã –∑–Ω–∞–µ–º, —á—Ç–æ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞.

–° Generics:

```typescript
function identity<T>(value: T): T {
  return value;
}

const result = identity("Hello"); // result: string ‚úÖ
const num = identity(42);         // num: number ‚úÖ
```

TypeScript **–≤—ã–≤–æ–¥–∏—Ç —Ç–∏–ø** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! –¢–µ–ø–µ—Ä—å `result` –∏–º–µ–µ—Ç —Ç–∏–ø `string`, –∞ `num` ‚Äî `number`.

---

## 1. Generic-—Ñ—É–Ω–∫—Ü–∏–∏

### –ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

```typescript
function firstElement<T>(arr: T[]): T | undefined {
  return arr[0];
}

const first = firstElement([1, 2, 3]);     // first: number | undefined
const char = firstElement(["a", "b"]);     // char: string | undefined
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- `<T>` ‚Äî —ç—Ç–æ **–ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∏–ø–∞** (type parameter)
- `T` ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–∏–ø–∞, –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º –∏–º–µ–Ω–µ–º
- TypeScript –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç `T` –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

### –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —Ç–∏–ø–∞

–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–∏–ø –≤—Ä—É—á–Ω—É—é:

```typescript
function create<T>(value: T): T {
  return value;
}

const obj = create<{ name: string }>({ name: "–ê–ª–µ–∫—Å–µ–π" });
// obj: { name: string }
```

### –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–∏–ø–∞

```typescript
function pair<K, V>(key: K, value: V): [K, V] {
  return [key, value];
}

const p1 = pair("age", 25);        // [string, number]
const p2 = pair(1, "first");       // [number, string]
```

---

## 2. Generic-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ç–æ–∂–µ –º–æ–≥—É—Ç –±—ã—Ç—å generic:

```typescript
interface Box<T> {
  value: T;
}

const stringBox: Box<string> = { value: "Hello" };
const numberBox: Box<number> = { value: 42 };
```

### –ü—Ä–∏–º–µ—Ä: –û—Ç–≤–µ—Ç API

```typescript
interface ApiResponse<T> {
  success: boolean;
  data: T;
  error?: string;
}

interface User {
  id: number;
  name: string;
}

const userResponse: ApiResponse<User> = {
  success: true,
  data: { id: 1, name: "–ê–ª–µ–∫—Å–µ–π" },
};

const listResponse: ApiResponse<User[]> = {
  success: true,
  data: [
    { id: 1, name: "–ê–ª–µ–∫—Å–µ–π" },
    { id: 2, name: "–ú–∞—Ä–∏—è" },
  ],
};
```

### –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö

```typescript
interface KeyValuePair<K, V> {
  key: K;
  value: V;
}

const entry: KeyValuePair<string, number> = {
  key: "age",
  value: 25,
};
```

---

## 3. Generic-–∫–ª–∞—Å—Å—ã

–ö–ª–∞—Å—Å—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Generics –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö:

```typescript
class Stack<T> {
  private items: T[] = [];

  push(item: T): void {
    this.items.push(item);
  }

  pop(): T | undefined {
    return this.items.pop();
  }

  peek(): T | undefined {
    return this.items[this.items.length - 1];
  }

  isEmpty(): boolean {
    return this.items.length === 0;
  }
}

const numberStack = new Stack<number>();
numberStack.push(1);
numberStack.push(2);
console.log(numberStack.pop()); // 2

const stringStack = new Stack<string>();
stringStack.push("Hello");
stringStack.push("World");
console.log(stringStack.pop()); // "World"
```

---

## 4. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Generics (`extends`)

–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ **–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å**, –∫–∞–∫–∏–µ —Ç–∏–ø—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ Generic.

### –ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

```typescript
function getLength<T>(value: T): number {
  return value.length; // ‚ùå Error: Property 'length' does not exist on type 'T'
}
```

TypeScript –Ω–µ –∑–Ω–∞–µ—Ç, —á—Ç–æ —É `T` –µ—Å—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ `length`.

### –†–µ—à–µ–Ω–∏–µ: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `extends`

```typescript
interface HasLength {
  length: number;
}

function getLength<T extends HasLength>(value: T): number {
  return value.length; // ‚úÖ –¢–µ–ø–µ—Ä—å TypeScript –∑–Ω–∞–µ—Ç, —á—Ç–æ —É T –µ—Å—Ç—å length
}

getLength("Hello");        // ‚úÖ string –∏–º–µ–µ—Ç length
getLength([1, 2, 3]);      // ‚úÖ –º–∞—Å—Å–∏–≤ –∏–º–µ–µ—Ç length
getLength({ length: 10 }); // ‚úÖ –æ–±—ä–µ–∫—Ç —Å length
getLength(42);             // ‚ùå Error: number –Ω–µ –∏–º–µ–µ—Ç length
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–∏–ø

```typescript
function merge<T extends object, U extends object>(obj1: T, obj2: U): T & U {
  return { ...obj1, ...obj2 };
}

const merged = merge({ name: "–ê–ª–µ–∫—Å–µ–π" }, { age: 25 });
// merged: { name: string } & { age: number }

merge({ a: 1 }, "string"); // ‚ùå Error: string –Ω–µ —è–≤–ª—è–µ—Ç—Å—è object
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ keyof

```typescript
function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
  return obj[key];
}

const person = { name: "–ê–ª–µ–∫—Å–µ–π", age: 25 };

const name = getProperty(person, "name");  // name: string
const age = getProperty(person, "age");    // age: number
const invalid = getProperty(person, "city"); // ‚ùå Error
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- `K extends keyof T` –æ–∑–Ω–∞—á–∞–µ—Ç: `K` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑ –∫–ª—é—á–µ–π –æ–±—ä–µ–∫—Ç–∞ `T`
- `T[K]` ‚Äî —ç—Ç–æ —Ç–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –∫–ª—é—á—É `K`

---

## 5. Generic —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Ç–∏–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```typescript
interface ApiResponse<T = unknown> {
  success: boolean;
  data: T;
}

const response1: ApiResponse<string> = {
  success: true,
  data: "Hello",
};

const response2: ApiResponse = {
  success: true,
  data: "anything", // data: unknown
};
```

---

## 6. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Generics

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Generics –∫–æ–≥–¥–∞:
- –ü–∏—à–µ—à—å **–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ** —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å—ã
- –ù—É–∂–Ω–∞ **—Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
- –†–∞–±–æ—Ç–∞–µ—à—å —Å **–∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏** (–º–∞—Å—Å–∏–≤—ã, —Å—Ç–µ–∫–∏, –æ—á–µ—Ä–µ–¥–∏)
- –°–æ–∑–¥–∞—ë—à—å **–æ–±—ë—Ä—Ç–∫–∏** –¥–ª—è API

### ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π Generics –∫–æ–≥–¥–∞:
- –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö **–≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ**
- –£—Å–ª–æ–∂–Ω—è–µ—à—å –∫–æ–¥ **–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ–ª—å–∑—ã**
- –ú–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å **union types** (`string | number`)

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–æ–¥—Ö–æ–¥ | –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å | –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å |
|--------|------------------|-------------------|------------|
| `any` | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è |
| –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è |
| Union (`\|`) | ‚úÖ –î–∞ | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ | ‚úÖ –°—Ä–µ–¥–Ω—è—è |
| Generics | ‚úÖ –î–∞ | ‚úÖ –î–∞ | ‚ö†Ô∏è –°–ª–æ–∂–Ω–µ–µ |

---

## üéØ –ü—Ä–∞–∫—Ç–∏–∫–∞ 3.2.2.1: Generic-–æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è –∫—ç—à–∞

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π generic-–∫–ª–∞—Å—Å `Cache<T>` –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ª—é–±—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å TTL.

### –®–∞–≥–∏:

1. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/modules/utils/GenericCache.ts`

2. –†–µ–∞–ª–∏–∑—É–π –∫–ª–∞—Å—Å —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
   ```typescript
   interface CacheEntry<T> {
     // –ó–Ω–∞—á–µ–Ω–∏–µ
     // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
   }

   export class Cache<T> {
     // private –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—ç—à–∞
     // private –ø–æ–ª–µ –¥–ª—è TTL

     constructor(ttl: number) {}

     set(key: string, value: T): void {}

     get(key: string): T | null {}

     has(key: string): boolean {}

     clear(): void {}

     getKeys(): string[] {}
   }
   ```

3. –î–æ–±–∞–≤—å –º–µ—Ç–æ–¥ `isExpired(entry: CacheEntry<T>): boolean` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞

4. –°–æ–∑–¥–∞–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test-generic-cache.ts`:
   ```typescript
   import { Cache } from "./src/modules/utils/GenericCache";
   import type { WeatherData } from "./src/types/weather";

   // –ö—ç—à –¥–ª—è –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   const weatherCache = new Cache<WeatherData>(60000); // 1 –º–∏–Ω—É—Ç–∞

   const mockWeather: WeatherData = {
     city: "–ú–æ—Å–∫–≤–∞",
     temperature: 5,
     feelsLike: 3,
     humidity: 80,
     pressure: 1013,
     windSpeed: 3.5,
     description: "–æ–±–ª–∞—á–Ω–æ",
     icon: "04d",
     country: "RU",
   };

   weatherCache.set("moscow", mockWeather);
   console.log("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:", weatherCache.get("moscow"));
   console.log("‚úÖ –ï—Å—Ç—å –≤ –∫—ç—à–µ:", weatherCache.has("moscow"));
   console.log("‚úÖ –ö–ª—é—á–∏:", weatherCache.getKeys());

   // –ö—ç—à –¥–ª—è —á–∏—Å–µ–ª
   const numberCache = new Cache<number>(5000);
   numberCache.set("count", 42);
   console.log("‚úÖ –ß–∏—Å–ª–æ –∏–∑ –∫—ç—à–∞:", numberCache.get("count"));

   // –ö—ç—à –¥–ª—è —Å—Ç—Ä–æ–∫
   const stringCache = new Cache<string[]>(10000);
   stringCache.set("cities", ["–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å"]);
   console.log("‚úÖ –ì–æ—Ä–æ–¥–∞ –∏–∑ –∫—ç—à–∞:", stringCache.get("cities"));
   ```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **generic** (`Cache<T>`)
- –ú–µ—Ç–æ–¥ `get` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null` –¥–ª—è **–∏—Å—Ç—ë–∫—à–∏—Ö** –∑–∞–ø–∏—Å–µ–π
- –ú–µ—Ç–æ–¥ `has` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false` –¥–ª—è **–∏—Å—Ç—ë–∫—à–∏—Ö** –∑–∞–ø–∏—Å–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–π `Map<string, CacheEntry<T>>` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</summary>

```typescript
interface CacheEntry<T> {
  value: T;
  timestamp: number;
}

export class Cache<T> {
  private cache: Map<string, CacheEntry<T>> = new Map();
  private ttl: number;

  constructor(ttl: number) {
    this.ttl = ttl;
  }

  private isExpired(entry: CacheEntry<T>): boolean {
    return Date.now() - entry.timestamp > this.ttl;
  }
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –ú–µ—Ç–æ–¥—ã set –∏ get</summary>

```typescript
set(key: string, value: T): void {
  const entry: CacheEntry<T> = {
    value,
    timestamp: Date.now(),
  };
  this.cache.set(key, entry);
}

get(key: string): T | null {
  const entry = this.cache.get(key);

  if (!entry) {
    return null;
  }

  if (this.isExpired(entry)) {
    this.cache.delete(key);
    return null;
  }

  return entry.value;
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –ú–µ—Ç–æ–¥—ã has, clear –∏ getKeys</summary>

```typescript
has(key: string): boolean {
  const entry = this.cache.get(key);

  if (!entry) {
    return false;
  }

  if (this.isExpired(entry)) {
    this.cache.delete(key);
    return false;
  }

  return true;
}

clear(): void {
  this.cache.clear();
}

getKeys(): string[] {
  const validKeys: string[] = [];

  for (const [key, entry] of this.cache.entries()) {
    if (!this.isExpired(entry)) {
      validKeys.push(key);
    } else {
      this.cache.delete(key);
    }
  }

  return validKeys;
}
```
</details>

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
npm run build
node dist/test-generic-cache.js
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: { city: '–ú–æ—Å–∫–≤–∞', temperature: 5, ... }
‚úÖ –ï—Å—Ç—å –≤ –∫—ç—à–µ: true
‚úÖ –ö–ª—é—á–∏: [ 'moscow' ]
‚úÖ –ß–∏—Å–ª–æ –∏–∑ –∫—ç—à–∞: 42
‚úÖ –ì–æ—Ä–æ–¥–∞ –∏–∑ –∫—ç—à–∞: [ '–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å' ]
```

---

## üéØ –ü—Ä–∞–∫—Ç–∏–∫–∞ 3.2.2.2: Generic-—Ñ—É–Ω–∫—Ü–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å –Ω–∞–±–æ—Ä generic-—Ñ—É–Ω–∫—Ü–∏–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–≥–æ–¥—ã.

### –®–∞–≥–∏:

1. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/modules/utils/genericHelpers.ts`

2. –†–µ–∞–ª–∏–∑—É–π —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

   **–§—É–Ω–∫—Ü–∏—è 1:** –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –∫–ª—é—á—É
   ```typescript
   // –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –º–∞—Å—Å–∏–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∫–ª—é—á—É
   export function pluck<T, K extends keyof T>(
     arr: T[],
     key: K
   ): T[K][] {
     // –í–µ—Ä–Ω–∏ –º–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –∫–ª—é—á—É key
   }
   ```

   **–§—É–Ω–∫—Ü–∏—è 2:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–≤–æ–π—Å—Ç–≤—É
   ```typescript
   // –§–∏–ª—å—Ç—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –≥–¥–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∑–∞–¥–∞–Ω–Ω—ã–º
   export function filterByProperty<T, K extends keyof T>(
     arr: T[],
     key: K,
     value: T[K]
   ): T[] {
     // –í–µ—Ä–Ω–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
   }
   ```

   **–§—É–Ω–∫—Ü–∏—è 3:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∏—Å–ª–æ–≤–æ–º—É —Å–≤–æ–π—Å—Ç–≤—É
   ```typescript
   // –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —á–∏—Å–ª–æ–≤–æ–º—É —Å–≤–æ–π—Å—Ç–≤—É
   export function sortByNumber<T, K extends keyof T>(
     arr: T[],
     key: K
   ): T[] {
     // –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É ‚Äî —ç—Ç–æ —á–∏—Å–ª–æ
     // –í–µ—Ä–Ω–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
   }
   ```

   **–§—É–Ω–∫—Ü–∏—è 4:** –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–≤–æ–π—Å—Ç–≤—É
   ```typescript
   // –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞
   export function groupBy<T, K extends keyof T>(
     arr: T[],
     key: K
   ): Record<string, T[]> {
     // –í–µ—Ä–Ω–∏ –æ–±—ä–µ–∫—Ç, –≥–¥–µ –∫–ª—é—á–∏ ‚Äî –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤–∞ key
     // –∞ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –º–∞—Å—Å–∏–≤—ã –æ–±—ä–µ–∫—Ç–æ–≤ —Å —ç—Ç–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
   }
   ```

3. –°–æ–∑–¥–∞–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test-generic-helpers.ts`:
   ```typescript
   import type { WeatherData } from "./src/types/weather";
   import {
     pluck,
     filterByProperty,
     sortByNumber,
     groupBy,
   } from "./src/modules/utils/genericHelpers";

   const cities: WeatherData[] = [
     {
       city: "–ú–æ—Å–∫–≤–∞",
       temperature: 5,
       feelsLike: 3,
       humidity: 80,
       pressure: 1013,
       windSpeed: 3.5,
       description: "–æ–±–ª–∞—á–Ω–æ",
       icon: "04d",
       country: "RU",
     },
     {
       city: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
       temperature: 2,
       feelsLike: -1,
       humidity: 85,
       pressure: 1010,
       windSpeed: 5.0,
       description: "–¥–æ–∂–¥—å",
       icon: "10d",
       country: "RU",
     },
     {
       city: "–ö–∞–∑–∞–Ω—å",
       temperature: 8,
       feelsLike: 6,
       humidity: 75,
       pressure: 1015,
       windSpeed: 2.5,
       description: "—è—Å–Ω–æ",
       icon: "01d",
       country: "RU",
     },
   ];

   console.log("=== –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä ===");
   console.log(pluck(cities, "temperature")); // [5, 2, 8]

   console.log("\n=== –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–µ ===");
   console.log(filterByProperty(cities, "country", "RU").length); // 3

   console.log("\n=== –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ ===");
   const sorted = sortByNumber(cities, "temperature");
   console.log(sorted.map((c) => `${c.city}: ${c.temperature}¬∞C`));

   console.log("\n=== –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é ===");
   const grouped = groupBy(cities, "description");
   console.log(Object.keys(grouped)); // ['–æ–±–ª–∞—á–Ω–æ', '–¥–æ–∂–¥—å', '—è—Å–Ω–æ']
   ```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **generic**
- –ò—Å–ø–æ–ª—å–∑—É–π **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** `extends keyof T`
- `sortByNumber` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —ç—Ç–æ —á–∏—Å–ª–æ
- `groupBy` –¥–æ–ª–∂–µ–Ω –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏ –≤ —Å—Ç—Ä–æ–∫–∏

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –§—É–Ω–∫—Ü–∏—è pluck</summary>

```typescript
export function pluck<T, K extends keyof T>(arr: T[], key: K): T[K][] {
  return arr.map((item) => item[key]);
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –§—É–Ω–∫—Ü–∏—è filterByProperty</summary>

```typescript
export function filterByProperty<T, K extends keyof T>(
  arr: T[],
  key: K,
  value: T[K]
): T[] {
  return arr.filter((item) => item[key] === value);
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –§—É–Ω–∫—Ü–∏—è sortByNumber</summary>

```typescript
export function sortByNumber<T, K extends keyof T>(arr: T[], key: K): T[] {
  return [...arr].sort((a, b) => {
    const aValue = a[key];
    const bValue = b[key];

    if (typeof aValue !== "number" || typeof bValue !== "number") {
      throw new Error(`Property ${String(key)} is not a number`);
    }

    return aValue - bValue;
  });
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 4: –§—É–Ω–∫—Ü–∏—è groupBy</summary>

```typescript
export function groupBy<T, K extends keyof T>(
  arr: T[],
  key: K
): Record<string, T[]> {
  const result: Record<string, T[]> = {};

  for (const item of arr) {
    const keyValue = String(item[key]);

    if (!result[keyValue]) {
      result[keyValue] = [];
    }

    result[keyValue].push(item);
  }

  return result;
}
```
</details>

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
npm run build
node dist/test-generic-helpers.js
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
=== –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä ===
[ 5, 2, 8 ]

=== –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–µ ===
3

=== –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ ===
[ '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥: 2¬∞C', '–ú–æ—Å–∫–≤–∞: 5¬∞C', '–ö–∞–∑–∞–Ω—å: 8¬∞C' ]

=== –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é ===
[ '–æ–±–ª–∞—á–Ω–æ', '–¥–æ–∂–¥—å', '—è—Å–Ω–æ' ]
```

---

## üéØ –ü—Ä–∞–∫—Ç–∏–∫–∞ 3.2.2.3: Generic-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è API

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–±—ë—Ä—Ç–∫—É –¥–ª—è API-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º generic-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

### –®–∞–≥–∏:

1. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/modules/api/ApiClient.ts`

2. –û–ø—Ä–µ–¥–µ–ª–∏ generic-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:
   ```typescript
   // –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
   export interface ApiSuccess<T> {
     success: true;
     data: T;
     timestamp: number;
   }

   // –û—à–∏–±–∫–∞
   export interface ApiError {
     success: false;
     error: string;
     code: number;
   }

   // –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞
   export type ApiResponse<T> = ApiSuccess<T> | ApiError;
   ```

3. –°–æ–∑–¥–∞–π generic-–∫–ª–∞—Å—Å `ApiClient`:
   ```typescript
   export class ApiClient {
     private baseUrl: string;

     constructor(baseUrl: string) {
       this.baseUrl = baseUrl;
     }

     async get<T>(endpoint: string): Promise<ApiResponse<T>> {
       // –†–µ–∞–ª–∏–∑—É–π GET-–∑–∞–ø—Ä–æ—Å
       // –û–±–µ—Ä–Ω–∏ –≤ try-catch
       // –í–µ—Ä–Ω–∏ ApiSuccess –∏–ª–∏ ApiError
     }

     async post<T, D = unknown>(
       endpoint: string,
       data: D
     ): Promise<ApiResponse<T>> {
       // –†–µ–∞–ª–∏–∑—É–π POST-–∑–∞–ø—Ä–æ—Å
     }
   }
   ```

4. –†–∞—Å—à–∏—Ä—å `WeatherService` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `ApiClient`:
   ```typescript
   // –í WeatherService.ts
   import { ApiClient } from "../api/ApiClient";
   import type { ApiResponse } from "../api/ApiClient";

   // –í–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ WeatherService –¥–æ–±–∞–≤—å –º–µ—Ç–æ–¥:
   async fetchWeatherViaApi(city: string): Promise<WeatherData> {
     const apiClient = new ApiClient(this.baseUrl);
     const response = await apiClient.get<any>(
       `/weather?q=${city}&appid=${this.apiKey}&units=metric&lang=${this.lang}`
     );

     if (!response.success) {
       throw new Error(response.error);
     }

     // –ú–∞–ø–ø–∏–Ω–≥ data –≤ WeatherData
     return this.mapResponseToWeatherData(response.data);
   }
   ```

5. –°–æ–∑–¥–∞–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test-api-client.ts`:
   ```typescript
   import { ApiClient } from "./src/modules/api/ApiClient";

   const client = new ApiClient("https://jsonplaceholder.typicode.com");

   interface Post {
     userId: number;
     id: number;
     title: string;
     body: string;
   }

   async function test() {
     // GET –∑–∞–ø—Ä–æ—Å
     const response = await client.get<Post>("/posts/1");

     if (response.success) {
       console.log("‚úÖ –£—Å–ø–µ—Ö:", response.data.title);
       console.log("Timestamp:", new Date(response.timestamp).toLocaleString());
     } else {
       console.log("‚ùå –û—à–∏–±–∫–∞:", response.error);
     }

     // POST –∑–∞–ø—Ä–æ—Å
     const newPost = {
       title: "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç",
       body: "–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞",
       userId: 1,
     };

     const postResponse = await client.post<Post, typeof newPost>(
       "/posts",
       newPost
     );

     if (postResponse.success) {
       console.log("‚úÖ –ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω:", postResponse.data);
     } else {
       console.log("‚ùå –û—à–∏–±–∫–∞:", postResponse.error);
     }
   }

   test();
   ```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–π **type guard** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `response.success`
- –í—Å–µ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `ApiResponse<T>`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `try-catch`
- –î–æ–±–∞–≤–ª—è–π `timestamp` –≤ —É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –ú–µ—Ç–æ–¥ get</summary>

```typescript
async get<T>(endpoint: string): Promise<ApiResponse<T>> {
  try {
    const url = `${this.baseUrl}${endpoint}`;
    const response = await fetch(url);

    if (!response.ok) {
      return {
        success: false,
        error: `HTTP error! status: ${response.status}`,
        code: response.status,
      };
    }

    const data = await response.json();

    return {
      success: true,
      data: data as T,
      timestamp: Date.now(),
    };
  } catch (error) {
    return {
      success: false,
      error: error instanceof Error ? error.message : "Unknown error",
      code: 0,
    };
  }
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –ú–µ—Ç–æ–¥ post</summary>

```typescript
async post<T, D = unknown>(
  endpoint: string,
  data: D
): Promise<ApiResponse<T>> {
  try {
    const url = `${this.baseUrl}${endpoint}`;
    const response = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      return {
        success: false,
        error: `HTTP error! status: ${response.status}`,
        code: response.status,
      };
    }

    const responseData = await response.json();

    return {
      success: true,
      data: responseData as T,
      timestamp: Date.now(),
    };
  } catch (error) {
    return {
      success: false,
      error: error instanceof Error ? error.message : "Unknown error",
      code: 0,
    };
  }
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ WeatherService</summary>

```typescript
// –î–æ–±–∞–≤—å –≤ WeatherService.ts

private mapResponseToWeatherData(data: any): WeatherData {
  return {
    city: data.name,
    temperature: data.main.temp,
    feelsLike: data.main.feels_like,
    humidity: data.main.humidity,
    pressure: data.main.pressure,
    windSpeed: data.wind.speed,
    description: data.weather[0].description,
    icon: data.weather[0].icon,
    country: data.sys.country,
  };
}

async fetchWeatherViaApi(city: string): Promise<WeatherData> {
  const apiClient = new ApiClient(this.baseUrl);
  const response = await apiClient.get<any>(
    `/weather?q=${city}&appid=${this.apiKey}&units=metric&lang=${this.lang}`
  );

  if (!response.success) {
    this.handleError(new Error(response.error));
  }

  return this.mapResponseToWeatherData(response.data);
}
```
</details>

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
npm run build
node dist/test-api-client.js
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –£—Å–ø–µ—Ö: sunt aut facere repellat provident occaecati...
Timestamp: 16.02.2026, 15:30:45
‚úÖ –ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω: { id: 101, title: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç', ... }
```

---

## üéØ –ü—Ä–∞–∫—Ç–∏–∫–∞ 3.2.2.4: Generic-–∫–ª–∞—Å—Å –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å generic-–∫–ª–∞—Å—Å `History<T>` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã (undo).

### –®–∞–≥–∏:

1. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/modules/utils/History.ts`

2. –†–µ–∞–ª–∏–∑—É–π –∫–ª–∞—Å—Å:
   ```typescript
   export class History<T> {
     private items: T[] = [];
     private currentIndex: number = -1;
     private maxSize: number;

     constructor(maxSize: number = 50) {
       this.maxSize = maxSize;
     }

     // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
     push(item: T): void {}

     // –û—Ç–º–µ–Ω–∏—Ç—å (–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)
     undo(): T | null {}

     // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å (–≤–µ—Ä–Ω—É—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)
     redo(): T | null {}

     // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
     current(): T | null {}

     // –ü—Ä–æ–≤–µ—Ä–∫–∏
     canUndo(): boolean {}
     canRedo(): boolean {}

     // –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
     clear(): void {}

     // –ü–æ–ª—É—á–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
     getAll(): T[] {}
   }
   ```

3. –°–æ–∑–¥–∞–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–≥–æ–¥—ã:
   ```typescript
   // –í src/types/weather.ts –¥–æ–±–∞–≤—å:
   export interface SearchQuery {
     city: string;
     timestamp: number;
     result?: WeatherData;
   }
   ```

4. –°–æ–∑–¥–∞–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test-history.ts`:
   ```typescript
   import { History } from "./src/modules/utils/History";
   import type { SearchQuery } from "./src/types/weather";

   const searchHistory = new History<SearchQuery>(10);

   // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   searchHistory.push({
     city: "–ú–æ—Å–∫–≤–∞",
     timestamp: Date.now(),
   });

   searchHistory.push({
     city: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
     timestamp: Date.now(),
   });

   searchHistory.push({
     city: "–ö–∞–∑–∞–Ω—å",
     timestamp: Date.now(),
   });

   console.log("–¢–µ–∫—É—â–∏–π:", searchHistory.current()?.city); // –ö–∞–∑–∞–Ω—å

   console.log("Undo:", searchHistory.undo()?.city); // –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
   console.log("Undo:", searchHistory.undo()?.city); // –ú–æ—Å–∫–≤–∞

   console.log("Redo:", searchHistory.redo()?.city); // –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥

   console.log("–ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å:", searchHistory.canUndo()); // true
   console.log("–ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å:", searchHistory.canRedo()); // true

   console.log("\n–í—Å—è –∏—Å—Ç–æ—Ä–∏—è:");
   console.log(searchHistory.getAll().map((q) => q.city)); // ['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å']
   ```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ü—Ä–∏ `push` –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞**
- –ï—Å–ª–∏ –ø–æ—Å–ª–µ `undo` –≤—ã–∑–≤–∞–Ω `push`, –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ **—É–¥–∞–ª—è—é—Ç—Å—è**
- –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç `maxSize`, —É–¥–∞–ª—è–µ—Ç—Å—è **—Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π** —ç–ª–µ–º–µ–Ω—Ç
- –í—Å–µ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å **–ª—é–±—ã–º —Ç–∏–ø–æ–º** `T`

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –ú–µ—Ç–æ–¥—ã push –∏ current</summary>

```typescript
push(item: T): void {
  // –£–¥–∞–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
  this.items = this.items.slice(0, this.currentIndex + 1);

  // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
  this.items.push(item);

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä
  if (this.items.length > this.maxSize) {
    this.items.shift();
  } else {
    this.currentIndex++;
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å
  this.currentIndex = this.items.length - 1;
}

current(): T | null {
  if (this.currentIndex < 0 || this.currentIndex >= this.items.length) {
    return null;
  }
  return this.items[this.currentIndex];
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –ú–µ—Ç–æ–¥—ã undo –∏ redo</summary>

```typescript
undo(): T | null {
  if (!this.canUndo()) {
    return null;
  }

  this.currentIndex--;
  return this.current();
}

redo(): T | null {
  if (!this.canRedo()) {
    return null;
  }

  this.currentIndex++;
  return this.current();
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã</summary>

```typescript
canUndo(): boolean {
  return this.currentIndex > 0;
}

canRedo(): boolean {
  return this.currentIndex < this.items.length - 1;
}

clear(): void {
  this.items = [];
  this.currentIndex = -1;
}

getAll(): T[] {
  return [...this.items];
}
```
</details>

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
npm run build
node dist/test-history.js
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–¢–µ–∫—É—â–∏–π: –ö–∞–∑–∞–Ω—å
Undo: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
Undo: –ú–æ—Å–∫–≤–∞
Redo: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
–ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å: true
–ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å: true

–í—Å—è –∏—Å—Ç–æ—Ä–∏—è:
[ '–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å' ]
```

---

## üéØ –ü—Ä–∞–∫—Ç–∏–∫–∞ 3.2.2.5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Generic-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–≤ –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ generic-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: `Cache<T>`, `History<T>`, `ApiClient` –∏ generic-—Ñ—É–Ω–∫—Ü–∏–∏. –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

### –®–∞–≥–∏:

1. **–û–±–Ω–æ–≤–∏ `index.html`** ‚Äî –¥–æ–±–∞–≤—å —Å–µ–∫—Ü–∏—é –∏—Å—Ç–æ—Ä–∏–∏:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–æ–≥–æ–¥–∞ - TypeScript Weather App</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 32px;
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    #city-input {
      flex: 1;
      padding: 12px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    #city-input:focus {
      outline: none;
      border-color: #667eea;
    }

    #search-btn {
      padding: 12px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    #search-btn:hover {
      transform: translateY(-2px);
    }

    .history-section {
      margin-bottom: 20px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 10px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .history-header h3 {
      font-size: 16px;
      color: #666;
    }

    .history-controls {
      display: flex;
      gap: 10px;
    }

    .history-btn {
      padding: 6px 12px;
      background: white;
      border: 2px solid #667eea;
      color: #667eea;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .history-btn:hover:not(:disabled) {
      background: #667eea;
      color: white;
    }

    .history-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .history-list {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .history-item {
      padding: 8px 15px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .history-item:hover {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .history-item.active {
      background: #764ba2;
      color: white;
      border-color: #764ba2;
    }

    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
      font-size: 14px;
      color: #666;
    }

    .error {
      background: #fee;
      border-left: 4px solid #f44336;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      color: #c62828;
      display: none;
    }

    .weather-card {
      display: none;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .weather-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .weather-header h2 {
      font-size: 36px;
      color: #333;
      margin-bottom: 10px;
    }

    .weather-header .description {
      font-size: 18px;
      color: #666;
      text-transform: capitalize;
    }

    .temperature {
      text-align: center;
      font-size: 72px;
      font-weight: bold;
      color: #667eea;
      margin: 30px 0;
    }

    .weather-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 30px;
    }

    .detail-item {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }

    .detail-item .label {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .detail-item .value {
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }

    .cache-indicator {
      text-align: center;
      margin-top: 20px;
      padding: 10px;
      background: #e8f5e9;
      border-radius: 8px;
      color: #2e7d32;
      font-weight: 600;
      display: none;
    }

    .loading {
      text-align: center;
      padding: 40px;
      display: none;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚õÖ –ü–æ–≥–æ–¥–∞</h1>

    <div class="search-box">
      <input
        type="text"
        id="city-input"
        placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..."
        value="–ú–æ—Å–∫–≤–∞"
      >
      <button id="search-btn">–ü–æ–∏—Å–∫</button>
    </div>

    <div class="history-section">
      <div class="history-header">
        <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞</h3>
        <div class="history-controls">
          <button class="history-btn" id="undo-btn" disabled>‚Üê –ù–∞–∑–∞–¥</button>
          <button class="history-btn" id="redo-btn" disabled>–í–ø–µ—Ä—ë–¥ ‚Üí</button>
          <button class="history-btn" id="clear-history-btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
      <div class="history-list" id="history-list">
        <span style="color: #999; font-size: 14px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</span>
      </div>
    </div>

    <div class="stats">
      <span id="cache-stats">–ö—ç—à: 0 –∑–∞–ø–∏—Å–µ–π</span>
      <span id="history-stats">–ò—Å—Ç–æ—Ä–∏—è: 0 –∑–∞–ø—Ä–æ—Å–æ–≤</span>
    </div>

    <div class="error" id="error"></div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="margin-top: 15px; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <div class="weather-card" id="weather-card">
      <div class="weather-header">
        <h2 id="city-name">‚Äî</h2>
        <p class="description" id="description">‚Äî</p>
      </div>

      <div class="temperature" id="temperature">‚Äî</div>

      <div class="weather-details">
        <div class="detail-item">
          <div class="label">–û—â—É—â–∞–µ—Ç—Å—è</div>
          <div class="value" id="feels-like">‚Äî</div>
        </div>
        <div class="detail-item">
          <div class="label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
          <div class="value" id="humidity">‚Äî</div>
        </div>
        <div class="detail-item">
          <div class="label">–î–∞–≤–ª–µ–Ω–∏–µ</div>
          <div class="value" id="pressure">‚Äî</div>
        </div>
        <div class="detail-item">
          <div class="label">–í–µ—Ç–µ—Ä</div>
          <div class="value" id="wind">‚Äî</div>
        </div>
      </div>

      <div class="cache-indicator" id="cache-indicator">
        ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –∫—ç—à–∞
      </div>
    </div>
  </div>

  <script type="module" src="/src/app.ts"></script>
</body>
</html>
```

2. **–û–±–Ω–æ–≤–∏ `src/modules/services/WeatherService.ts`** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `ApiClient` –∏ `Cache<T>`:
   ```typescript
   // –ó–∞–º–µ–Ω–∏ —Å—Ç–∞—Ä—ã–π –∫—ç—à –Ω–∞ Generic Cache
   import { Cache } from "../utils/GenericCache.js";
   import { ApiClient } from "../api/ApiClient.js";
   import type { ApiResponse } from "../api/ApiClient.js";

   export class WeatherService extends BaseService {
     private apiKey: string;
     private baseUrl: string = "https://api.openweathermap.org/data/2.5";
     private cache: Cache<WeatherData>; // Generic –∫—ç—à
     // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è

     constructor(apiKey: string, lang: string = "ru", cacheTTL: number = 600000) {
       super("WeatherService");
       this.apiKey = apiKey;
       this.lang = lang;
       this.cacheTTL = cacheTTL;
       this.cache = new Cache<WeatherData>(cacheTTL); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è generic –∫—ç—à–∞
     }

     async getData(city: string): Promise<WeatherData> {
       // –ü—Ä–æ–≤–µ—Ä—å –∫—ç—à —á–µ—Ä–µ–∑ cache.get(city)
       // –ï—Å–ª–∏ –µ—Å—Ç—å ‚Äî –≤–µ—Ä–Ω–∏
       // –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π ApiClient –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
       // –°–æ—Ö—Ä–∞–Ω–∏ –≤ –∫—ç—à —á–µ—Ä–µ–∑ cache.set(city, data)
       // –í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
     }

     getCacheKeys(): string[] {
       return this.cache.getKeys();
     }

     clearCache(): void {
       this.cache.clear();
     }
   }
   ```

3. **–û–±–Ω–æ–≤–∏ `src/app.ts`** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `History<T>` –∏ generic-—Ñ—É–Ω–∫—Ü–∏–π:
   ```typescript
   // src/app.ts
   import { WeatherService } from "./modules/services/WeatherService.js";
   import { History } from "./modules/utils/History.js";
   import { pluck, sortByNumber } from "./modules/utils/genericHelpers.js";
   import type { WeatherData, SearchQuery } from "./types/weather.js";

   const API_KEY = "—Ç–≤–æ–π-api-–∫–ª—é—á";

   const weatherService = new WeatherService(API_KEY);
   const searchHistory = new History<SearchQuery>(20);

   let currentWeatherData: WeatherData | null = null;

   // –ü–æ–ª—É—á–∏ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM
   // ...

   // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –∏—Å—Ç–æ—Ä–∏–∏
   function updateHistoryUI(): void {
     // –û—Ç–æ–±—Ä–∞–∑–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ searchHistory.getAll()
     // –û–±–Ω–æ–≤–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ undo/redo
     // –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
   }

   // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
   async function fetchWeather(city: string): Promise<void> {
     // –í–∞–ª–∏–¥–∏—Ä—É–π –≥–æ—Ä–æ–¥
     // –ü–æ–∫–∞–∂–∏ loading
     // –í—ã–∑–æ–≤–∏ weatherService.getData(city)
     // –°–æ—Ö—Ä–∞–Ω–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é —á–µ—Ä–µ–∑ searchHistory.push()
     // –û—Ç–æ–±—Ä–∞–∑–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
     // –û–±–Ω–æ–≤–∏ UI –∏—Å—Ç–æ—Ä–∏–∏
   }

   // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ undo/redo
   function handleUndo(): void {
     // –í—ã–∑–æ–≤–∏ searchHistory.undo()
     // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –æ—Ç–æ–±—Ä–∞–∑–∏ –µ–≥–æ
   }

   function handleRedo(): void {
     // –í—ã–∑–æ–≤–∏ searchHistory.redo()
     // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –æ—Ç–æ–±—Ä–∞–∑–∏ –µ–≥–æ
   }

   // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É –∏—Å—Ç–æ—Ä–∏–∏
   function handleHistoryItemClick(query: SearchQuery): void {
     // –û—Ç–æ–±—Ä–∞–∑–∏ –ø–æ–≥–æ–¥—É –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   }

   // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   // ...
   ```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–π **Generic Cache** –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞
- –ò—Å–ø–æ–ª—å–∑—É–π **Generic History** –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞
- –ò—Å–ø–æ–ª—å–∑—É–π **ApiClient** –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ WeatherService
- –û—Ç–æ–±—Ä–∞–∂–∞–π –∏—Å—Ç–æ—Ä–∏—é —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é **undo/redo**
- –ü–æ–∫–∞–∑—ã–≤–∞–π **–∞–∫—Ç–∏–≤–Ω—ã–π** —ç–ª–µ–º–µ–Ω—Ç –≤ –∏—Å—Ç–æ—Ä–∏–∏
- –û–±–Ω–æ–≤–ª—è–π **—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** (–∫—ç—à –∏ –∏—Å—Ç–æ—Ä–∏—è)
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî **–ø–æ–∫–∞–∑—ã–≤–∞–π –ø–æ–≥–æ–¥—É**

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ WeatherService —Å Generic Cache</summary>

```typescript
// src/modules/services/WeatherService.ts
import { BaseService } from "./BaseService.js";
import { Cache } from "../utils/GenericCache.js";
import { ApiClient } from "../api/ApiClient.js";
import type { WeatherData } from "../../types/weather.js";

export class WeatherService extends BaseService {
  private apiKey: string;
  private baseUrl: string = "https://api.openweathermap.org/data/2.5";
  readonly lang: string;
  readonly cacheTTL: number;
  private _units: "celsius" | "fahrenheit" = "celsius";
  private cache: Cache<WeatherData>;

  constructor(apiKey: string, lang: string = "ru", cacheTTL: number = 600000) {
    super("WeatherService");
    this.apiKey = apiKey;
    this.lang = lang;
    this.cacheTTL = cacheTTL;
    this.cache = new Cache<WeatherData>(cacheTTL);
  }

  get units(): "celsius" | "fahrenheit" {
    return this._units;
  }

  set units(value: "celsius" | "fahrenheit") {
    if (value !== "celsius" && value !== "fahrenheit") {
      throw new Error(`–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è: ${value}`);
    }
    this._units = value;
  }

  async getData(city: string): Promise<WeatherData> {
    const cached = this.cache.get(city);
    if (cached) {
      this.log(`‚úÖ –ö—ç—à: –¥–∞–Ω–Ω—ã–µ –¥–ª—è ${city} –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –∫—ç—à–∞`);
      return cached;
    }

    this.log(`üåê API: –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è ${city}`);

    const apiClient = new ApiClient(this.baseUrl);
    const units = this._units === "celsius" ? "metric" : "imperial";
    const response = await apiClient.get<any>(
      `/weather?q=${city}&appid=${this.apiKey}&units=${units}&lang=${this.lang}`
    );

    if (!response.success) {
      this.handleError(new Error(response.error));
    }

    const weatherData: WeatherData = {
      city: response.data.name,
      temperature: response.data.main.temp,
      feelsLike: response.data.main.feels_like,
      humidity: response.data.main.humidity,
      pressure: response.data.main.pressure,
      windSpeed: response.data.wind.speed,
      description: response.data.weather[0].description,
      icon: response.data.weather[0].icon,
      country: response.data.sys.country,
    };

    this.cache.set(city, weatherData);
    return weatherData;
  }

  getCacheKeys(): string[] {
    return this.cache.getKeys();
  }

  clearCache(): void {
    this.cache.clear();
  }

  // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
  static isValidCityName(city: string): boolean {
    if (!city || city.trim().length < 2) {
      return false;
    }
    const cityRegex = /^[a-zA-Z–∞-—è–ê-–Ø—ë–Å\s\-]+$/;
    return cityRegex.test(city);
  }

  static formatTemperature(temp: number, unit: "celsius" | "fahrenheit"): string {
    const rounded = Math.round(temp);
    const symbol = unit === "celsius" ? "¬∞C" : "¬∞F";
    return `${rounded}${symbol}`;
  }

  static celsiusToFahrenheit(celsius: number): number {
    return celsius * 9/5 + 32;
  }

  static fahrenheitToCelsius(fahrenheit: number): number {
    return (fahrenheit - 32) * 5/9;
  }
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</summary>

```typescript
// src/app.ts
import { WeatherService } from "./modules/services/WeatherService.js";
import { History } from "./modules/utils/History.js";
import type { WeatherData, SearchQuery } from "./types/weather.js";

const API_KEY = "—Ç–≤–æ–π-api-–∫–ª—é—á";

const weatherService = new WeatherService(API_KEY);
const searchHistory = new History<SearchQuery>(20);

let currentWeatherData: WeatherData | null = null;

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const cityInput = document.getElementById("city-input") as HTMLInputElement;
const searchBtn = document.getElementById("search-btn") as HTMLButtonElement;
const errorDiv = document.getElementById("error") as HTMLDivElement;
const loadingDiv = document.getElementById("loading") as HTMLDivElement;
const weatherCard = document.getElementById("weather-card") as HTMLDivElement;
const cacheIndicator = document.getElementById("cache-indicator") as HTMLDivElement;

const cityNameEl = document.getElementById("city-name") as HTMLHeadingElement;
const descriptionEl = document.getElementById("description") as HTMLParagraphElement;
const temperatureEl = document.getElementById("temperature") as HTMLDivElement;
const feelsLikeEl = document.getElementById("feels-like") as HTMLDivElement;
const humidityEl = document.getElementById("humidity") as HTMLDivElement;
const pressureEl = document.getElementById("pressure") as HTMLDivElement;
const windEl = document.getElementById("wind") as HTMLDivElement;

const historyListEl = document.getElementById("history-list") as HTMLDivElement;
const undoBtn = document.getElementById("undo-btn") as HTMLButtonElement;
const redoBtn = document.getElementById("redo-btn") as HTMLButtonElement;
const clearHistoryBtn = document.getElementById("clear-history-btn") as HTMLButtonElement;
const cacheStatsEl = document.getElementById("cache-stats") as HTMLSpanElement;
const historyStatsEl = document.getElementById("history-stats") as HTMLSpanElement;

function displayWeather(data: WeatherData, fromCache: boolean): void {
  currentWeatherData = data;

  errorDiv.style.display = "none";
  loadingDiv.style.display = "none";
  weatherCard.style.display = "block";

  cityNameEl.textContent = `${data.city}, ${data.country}`;
  descriptionEl.textContent = data.description;
  temperatureEl.textContent = WeatherService.formatTemperature(data.temperature, weatherService.units);
  feelsLikeEl.textContent = WeatherService.formatTemperature(data.feelsLike, weatherService.units);
  humidityEl.textContent = `${data.humidity}%`;
  pressureEl.textContent = `${data.pressure} hPa`;
  windEl.textContent = `${data.windSpeed} –º/—Å`;

  cacheIndicator.style.display = fromCache ? "block" : "none";
}

function showError(message: string): void {
  errorDiv.textContent = message;
  errorDiv.style.display = "block";
  weatherCard.style.display = "none";
  loadingDiv.style.display = "none";
}

function updateStats(): void {
  const cacheKeys = weatherService.getCacheKeys();
  const historyItems = searchHistory.getAll();

  cacheStatsEl.textContent = `–ö—ç—à: ${cacheKeys.length} –∑–∞–ø–∏—Å–µ–π`;
  historyStatsEl.textContent = `–ò—Å—Ç–æ—Ä–∏—è: ${historyItems.length} –∑–∞–ø—Ä–æ—Å–æ–≤`;
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –†–∞–±–æ—Ç–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏ UI</summary>

```typescript
function updateHistoryUI(): void {
  const items = searchHistory.getAll();
  const currentItem = searchHistory.current();

  if (items.length === 0) {
    historyListEl.innerHTML = '<span style="color: #999; font-size: 14px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</span>';
  } else {
    historyListEl.innerHTML = "";
    items.forEach((item) => {
      const div = document.createElement("div");
      div.className = "history-item";
      if (currentItem && item.city === currentItem.city && item.timestamp === currentItem.timestamp) {
        div.classList.add("active");
      }
      div.textContent = item.city;
      div.onclick = () => handleHistoryItemClick(item);
      historyListEl.appendChild(div);
    });
  }

  undoBtn.disabled = !searchHistory.canUndo();
  redoBtn.disabled = !searchHistory.canRedo();

  updateStats();
}

async function fetchWeather(city?: string): Promise<void> {
  const searchCity = city || cityInput.value.trim();

  if (!WeatherService.isValidCityName(searchCity)) {
    showError("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–º–∏–Ω–∏–º—É–º 2 –±—É–∫–≤—ã)");
    return;
  }

  errorDiv.style.display = "none";
  weatherCard.style.display = "none";
  loadingDiv.style.display = "block";

  try {
    const startTime = Date.now();
    const data = await weatherService.getData(searchCity);
    const endTime = Date.now();
    const fromCache = endTime - startTime < 100;

    const query: SearchQuery = {
      city: searchCity,
      timestamp: Date.now(),
      result: data,
    };

    searchHistory.push(query);
    displayWeather(data, fromCache);
    updateHistoryUI();

    if (!city) {
      cityInput.value = searchCity;
    }
  } catch (error) {
    showError(error instanceof Error ? error.message : "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≥–æ–¥—É");
  }
}

function handleUndo(): void {
  const previous = searchHistory.undo();
  if (previous && previous.result) {
    displayWeather(previous.result, false);
    cityInput.value = previous.city;
    updateHistoryUI();
  }
}

function handleRedo(): void {
  const next = searchHistory.redo();
  if (next && next.result) {
    displayWeather(next.result, false);
    cityInput.value = next.city;
    updateHistoryUI();
  }
}

function handleHistoryItemClick(query: SearchQuery): void {
  if (query.result) {
    displayWeather(query.result, true);
    cityInput.value = query.city;
  } else {
    fetchWeather(query.city);
  }
}

function handleClearHistory(): void {
  if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞?")) {
    searchHistory.clear();
    updateHistoryUI();
    weatherCard.style.display = "none";
  }
}
```
</details>

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ 4: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</summary>

```typescript
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
searchBtn.addEventListener("click", () => fetchWeather());

cityInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    fetchWeather();
  }
});

undoBtn.addEventListener("click", handleUndo);
redoBtn.addEventListener("click", handleRedo);
clearHistoryBtn.addEventListener("click", handleClearHistory);

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≥–æ–¥—É –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞
fetchWeather();
```
</details>

### –ü—Ä–æ–≤–µ—Ä–∫–∞:

1. –ó–∞–ø—É—Å—Ç–∏ dev-—Å–µ—Ä–≤–µ—Ä:
   ```bash
   npm run dev
   ```

2. –û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

3. –ü—Ä–æ–≤–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
   - ‚úÖ –ü–æ–∏—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥–æ—Ä–æ–¥–æ–≤ (–ú–æ—Å–∫–≤–∞, –ö–∞–∑–∞–Ω—å, –°–æ—á–∏)
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –∏ "–í–ø–µ—Ä—ë–¥" —Ä–∞–±–æ—Ç–∞—é—Ç
   - ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤—ã–¥–µ–ª–µ–Ω
   - ‚úÖ –ö–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–≥–æ–¥—É
   - ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–∫—ç—à –∏ –∏—Å—Ç–æ—Ä–∏—è)
   - ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫—ç—à–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
   - ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å –∫–∞–∂–¥—ã–º –ø–æ–∏—Å–∫–æ–º
- –ú–æ–∂–Ω–æ –ª–∏—Å—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–Ω–æ–ø–∫–∞–º–∏ ‚Üê –∏ ‚Üí
- –ö–ª–∏–∫ –ø–æ –≥–æ—Ä–æ–¥—É –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–≥–æ –ø–æ–≥–æ–¥—É
- –ö—ç—à —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–∞–∑–¥–µ–ª–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–∞–∫—Ç–∏–∫ —Ç—ã –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å:

- [ ] –°–æ–∑–¥–∞–≤–∞—Ç—å generic-—Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ç–∏–ø–∞
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å generic-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∫–ª–∞—Å—Å—ã
- [ ] –ü—Ä–∏–º–µ–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ `extends`
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `keyof` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª—é—á–µ–π
- [ ] –°–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å Generics
- [ ] –ü–æ–Ω–∏–º–∞—Ç—å, –∫–æ–≥–¥–∞ Generics –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã, –∞ –∫–æ–≥–¥–∞ –∏–∑–±—ã—Ç–æ—á–Ω—ã
- [ ] –†–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ç–∏–ø–∞
- [ ] –ó–∞–¥–∞–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è generic-—Ç–∏–ø–æ–≤

---

## üîó –†–µ—Å—É—Ä—Å—ã

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [Generics](https://www.typescriptlang.org/docs/handbook/2/generics.html) ‚Äî –æ—Å–Ω–æ–≤—ã Generics
- [Generic Constraints](https://www.typescriptlang.org/docs/handbook/2/generics.html#generic-constraints) ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- [keyof operator](https://www.typescriptlang.org/docs/handbook/2/keyof-types.html) ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ keyof

**–°—Ç–∞—Ç—å–∏:**
- [Understanding TypeScript Generics](https://www.digitalocean.com/community/tutorials/typescript-generics-in-typescript) ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [When to use Generics](https://blog.logrocket.com/using-typescript-generics-create-reusable-components/) ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

**–í–∏–¥–µ–æ:**
- [–î–∂–µ–Ω–µ—Ä–∏–∫–∏ –≤ TypeScript —Å –Ω—É–ª—è - –í–∞—Å–∏–ª–∏–π –ú—É—Ä–∞–≤—å–µ–≤](https://www.youtube.com/watch?v=k16Hgi753XQ)
- [TypeScript Generics - Web Dev Simplified](https://www.youtube.com/watch?v=EcCTIExsqmI)

---

‚è± **–í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ**: 3-4 —á–∞—Å–∞

---

**–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Ç–µ–º–∞:** [3.2.1 –ö–ª–∞—Å—Å—ã –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã](./3.1.6-–ö–ª–∞—Å—Å—ã-–∏-–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã.md)

**–°–ª–µ–¥—É—é—â–∞—è —Ç–µ–º–∞:** [3.2.3 Utility Types](./3.2.3-Utility-Types.md)

---

[![–ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤](../static/callout.svg)](https://xmentors.ru/dev?utm_source=baza_js)

# 2.2.4 Event Loop

Event Loop ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç JavaScript –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –æ–Ω –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π. –ü–æ–Ω–∏–º–∞–Ω–∏–µ Event Loop ‚Äî –∫–ª—é—á –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

---

## üéØ –ß—Ç–æ —Ç—ã —É–∑–Ω–∞–µ—à—å

- –ü–æ—á–µ–º—É JavaScript –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π, –Ω–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
- –ß—Ç–æ —Ç–∞–∫–æ–µ Event Loop –∏ –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- Call Stack ‚Äî —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
- Web APIs ‚Äî –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ API –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Callback Queue (Task Queue) ‚Äî –æ—á–µ—Ä–µ–¥—å –∫–æ–ª–±—ç–∫–æ–≤
- Microtask Queue ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø—Ä–æ–º–∏—Å–æ–≤
- –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç setTimeout, Promise, async/await
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –æ–± Event Loop

---

## üìñ JavaScript ‚Äî –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π —è–∑—ã–∫

JavaScript –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –≤ **–æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ**. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
- –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
- –ù–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- –î–ª–∏–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```javascript
console.log('1');

// –¢—è–∂—ë–ª–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
for (let i = 0; i < 1000000000; i++) {}

console.log('2'); // –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–≥–∞—è (–∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É, —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞), –≤–µ—Å—å –∫–æ–¥ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** Event Loop + –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

## üìñ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Event Loop

### 1. Call Stack (—Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤)

**Call Stack** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö LIFO (Last In, First Out), –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

```javascript
function first() {
  console.log('–í–Ω—É—Ç—Ä–∏ first');
  second();
  console.log('–°–Ω–æ–≤–∞ –≤ first');
}

function second() {
  console.log('–í–Ω—É—Ç—Ä–∏ second');
}

first();
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Call Stack:**

```
1. first() ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å—Ç–µ–∫
   [first]

2. console.log('–í–Ω—É—Ç—Ä–∏ first') ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏ —É–¥–∞–ª—è–µ—Ç—Å—è
   [first]

3. second() ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å—Ç–µ–∫
   [first, second]

4. console.log('–í–Ω—É—Ç—Ä–∏ second') ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏ —É–¥–∞–ª—è–µ—Ç—Å—è
   [first, second]

5. second() –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è ‚Üí —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ —Å—Ç–µ–∫–∞
   [first]

6. console.log('–°–Ω–æ–≤–∞ –≤ first') ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏ —É–¥–∞–ª—è–µ—Ç—Å—è
   [first]

7. first() –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è ‚Üí —Å—Ç–µ–∫ –ø—É—Å—Ç
   []
```

**–í–∞–∂–Ω–æ:** JavaScript –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ Call Stack –ø–æ –æ–¥–Ω–æ–π!

---

### 2. Web APIs (Browser APIs)

**Web APIs** ‚Äî —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º–∞—è –±—Ä–∞—É–∑–µ—Ä–æ–º (–∏–ª–∏ Node.js):
- `setTimeout`, `setInterval`
- `fetch`, `XMLHttpRequest`
- DOM —Å–æ–±—ã—Ç–∏—è (click, scroll, etc.)
- `Promise` –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

```javascript
console.log('–ù–∞—á–∞–ª–æ');

setTimeout(() => {
  console.log('Timeout');
}, 0);

console.log('–ö–æ–Ω–µ—Ü');

// –í—ã–≤–æ–¥:
// –ù–∞—á–∞–ª–æ
// –ö–æ–Ω–µ—Ü
// Timeout (–ø–æ—á–µ–º—É –Ω–µ –º–µ–∂–¥—É –Ω–∏–º–∏?)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. `setTimeout` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ Call Stack
2. –û–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ Web API
3. Web API –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä
4. –ö–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä –∑–∞–≤–µ—Ä—à—ë–Ω, –∫–æ–ª–±—ç–∫ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Callback Queue

---

### 3. Callback Queue (Task Queue)

**Callback Queue** ‚Äî –æ—á–µ—Ä–µ–¥—å –∫–æ–ª–±—ç–∫–æ–≤, –æ–∂–∏–¥–∞—é—â–∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

```javascript
setTimeout(() => console.log('1'), 0);
setTimeout(() => console.log('2'), 0);
setTimeout(() => console.log('3'), 0);

// –í—ã–≤–æ–¥: 1, 2, 3 (–≤ –ø–æ—Ä—è–¥–∫–µ –æ—á–µ—Ä–µ–¥–∏)
```

**–ü—Ä–∞–≤–∏–ª–æ:** –ö–æ–ª–±—ç–∫–∏ –∏–∑ Callback Queue –ø–æ–ø–∞–¥–∞—é—Ç –≤ Call Stack **—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Å—Ç–µ–∫ –ø—É—Å—Ç**.

---

### 4. Microtask Queue (Job Queue)

**Microtask Queue** ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è:
- `.then()`, `.catch()`, `.finally()` –ø—Ä–æ–º–∏—Å–æ–≤
- `queueMicrotask()`
- `MutationObserver`

```javascript
console.log('1');

setTimeout(() => console.log('2'), 0);

Promise.resolve().then(() => console.log('3'));

console.log('4');

// –í—ã–≤–æ–¥:
// 1
// 4
// 3 (Promise - microtask, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ)
// 2 (setTimeout - task)
```

**–í–∞–∂–Ω–æ:** Microtask Queue –∏–º–µ–µ—Ç **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** –Ω–∞–¥ Callback Queue!

---

## üìñ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Event Loop

**Event Loop** ‚Äî –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π:

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç Call Stack
   - –ï—Å–ª–∏ –Ω–µ –ø—É—Å—Ç ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —Å—Ç–µ–∫–∞
   - –ï—Å–ª–∏ –ø—É—Å—Ç ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —à–∞–≥—É 2

2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç Microtask Queue
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç **–í–°–ï** –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ –¥–æ –ø–æ–ª–Ω–æ–≥–æ –æ–ø—É—Å—Ç–æ—à–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏

3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç Callback Queue
   - –ë–µ—Ä—ë—Ç **–û–î–ù–£** –∑–∞–¥–∞—á—É –∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –≤ Call Stack

4. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç —Å —à–∞–≥–∞ 1

**–°—Ö–µ–º–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Call Stack          ‚îÇ
‚îÇ   (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Microtask Queue     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ Promise.then, queueMicrotask
‚îÇ   (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Callback Queue      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ setTimeout, DOM events
‚îÇ   (–æ–±—ã—á–Ω–∞—è)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚Üì
      (–ø–æ–≤—Ç–æ—Ä —Ü–∏–∫–ª–∞)
```

---

## üìñ –ü—Ä–∏–º–µ—Ä—ã –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: setTimeout vs Promise

```javascript
console.log('1');

setTimeout(() => console.log('2'), 0);

Promise.resolve()
  .then(() => console.log('3'))
  .then(() => console.log('4'));

console.log('5');

// –í—ã–≤–æ–¥:
// 1
// 5
// 3
// 4
// 2
```

**–†–∞–∑–±–æ—Ä:**
1. `console.log('1')` ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É (Call Stack)
2. `setTimeout` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Web API
3. `Promise.resolve().then()` ‚Üí –∫–æ–ª–±—ç–∫ –≤ Microtask Queue
4. `console.log('5')` ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É (Call Stack)
5. Call Stack –ø—É—Å—Ç ‚Üí Event Loop –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Microtask Queue
6. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Å–µ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏: `3`, `4`
7. Event Loop –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Callback Queue
8. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `2` –∏–∑ setTimeout

---

### –ü—Ä–∏–º–µ—Ä 2: –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–∏—Å—ã

```javascript
console.log('Start');

setTimeout(() => console.log('Timeout'), 0);

Promise.resolve()
  .then(() => {
    console.log('Promise 1');
    return Promise.resolve();
  })
  .then(() => console.log('Promise 2'));

queueMicrotask(() => console.log('Microtask'));

console.log('End');

// –í—ã–≤–æ–¥:
// Start
// End
// Promise 1
// Microtask
// Promise 2
// Timeout
```

**–í–∞–∂–Ω–æ:** –í—Å–µ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –ª—é–±–æ–π –∑–∞–¥–∞—á–µ–π –∏–∑ Callback Queue!

---

### –ü—Ä–∏–º–µ—Ä 3: Async/await

```javascript
console.log('1');

async function test() {
  console.log('2');
  await Promise.resolve();
  console.log('3');
}

test();

console.log('4');

// –í—ã–≤–æ–¥:
// 1
// 2
// 4
// 3
```

**–ü–æ—á–µ–º—É?**
- `await` –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é
- –ö–æ–¥ –ø–æ—Å–ª–µ `await` –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Microtask Queue
- –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ (`4`), –ø–æ—Ç–æ–º –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∞ (`3`)

---

## üìñ setTimeout(fn, 0)

–ü–æ—á–µ–º—É `setTimeout(fn, 0)` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ?

```javascript
console.log('A');

setTimeout(() => console.log('B'), 0);

for (let i = 0; i < 3; i++) {
  console.log('C');
}

console.log('D');

// –í—ã–≤–æ–¥:
// A
// C
// C
// C
// D
// B
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
1. `setTimeout` —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 0 **–Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç "–≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–π—á–∞—Å"**
2. –ö–æ–ª–±—ç–∫ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Callback Queue
3. Event Loop –≤–æ–∑—å–º—ë—Ç –µ–≥–æ **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ** –æ–ø—É—Å—Ç–æ—à–µ–Ω–∏—è Call Stack
4. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤–µ—Å—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞:** –ë—Ä–∞—É–∑–µ—Ä—ã –∏–º–µ—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É ~4ms –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö setTimeout.

---

## üìñ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Event Loop

```javascript
console.log('–î–æ —Ü–∏–∫–ª–∞');

setTimeout(() => console.log('Timeout'), 0);

// –ë–ª–æ–∫–∏—Ä—É–µ–º Event Loop
for (let i = 0; i < 3000000000; i++) {}

console.log('–ü–æ—Å–ª–µ —Ü–∏–∫–ª–∞');

// –í—ã–≤–æ–¥:
// –î–æ —Ü–∏–∫–ª–∞
// (–¥–æ–ª–≥–∞—è –ø–∞—É–∑–∞)
// –ü–æ—Å–ª–µ —Ü–∏–∫–ª–∞
// Timeout
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –±–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop. –ö–æ–ª–±—ç–∫ –∏–∑ setTimeout –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è, –ø–æ–∫–∞ Call Stack –Ω–µ –æ–ø—É—Å—Ç–µ–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —á–∞—Å—Ç–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Web Workers.

---

## üå§Ô∏è –ü—Ä–∞–∫—Ç–∏–∫–∞: –ü–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ó–∞–¥–∞–Ω–∏–µ 2.2.4.1: –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ü—Ä–µ–¥—Å–∫–∞–∂–∏ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞:

```javascript
console.log('1');

setTimeout(() => console.log('2'), 0);

Promise.resolve()
  .then(() => console.log('3'))
  .then(() => console.log('4'));

async function test() {
  console.log('5');
  await Promise.resolve();
  console.log('6');
}

test();

console.log('7');
```

<details>
<summary>üí° –û—Ç–≤–µ—Ç</summary>

**–ü–æ—Ä—è–¥–æ–∫:** 1, 5, 7, 3, 6, 4, 2

**–†–∞–∑–±–æ—Ä:**
1. `1` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥
2. `setTimeout` ‚Üí –≤ Callback Queue
3. Promise `.then` ‚Üí –≤ Microtask Queue
4. `test()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
5. `5` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ async
6. `await` ‚Üí –∫–æ–¥ –ø–æ—Å–ª–µ –Ω–µ–≥–æ –≤ Microtask Queue
7. `7` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥
8. Call Stack –ø—É—Å—Ç ‚Üí –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏:
   - `3` (–ø–µ—Ä–≤—ã–π .then)
   - `6` (–ø–æ—Å–ª–µ await)
   - `4` (–≤—Ç–æ—Ä–æ–π .then)
9. Microtask Queue –ø—É—Å—Ç ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –∏–∑ Callback Queue:
   - `2` (setTimeout)
</details>

---

### –ó–∞–¥–∞–Ω–∏–µ 2.2.4.2: –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –ø–æ–≥–æ–¥–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–û–±—ä—è—Å–Ω–∏ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```javascript
const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á'; // –ü–æ–ª—É—á–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ https://openweathermap.org/api
const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

console.log('–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏');

function fetchWeather(city) {
  console.log('–ó–∞–ø—Ä–æ—Å –ø–æ–≥–æ–¥—ã –¥–ª—è:', city);

  return fetch(`${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`)
    .then(response => {
      console.log('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω');
      return response.json();
    })
    .then(data => {
      console.log('–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã');
      return data;
    });
}

setTimeout(() => {
  console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞');
}, 0);

fetchWeather('Moscow');

console.log('–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –í –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –≤—ã–≤–µ–¥—É—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è?
2. –ü–æ—á–µ–º—É "–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω" –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ä–∞–Ω—å—à–µ "–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω"?
3. –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ä–∞–Ω—å—à–µ: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã"?

<details>
<summary>üí° –û—Ç–≤–µ—Ç</summary>

**–ü–æ—Ä—è–¥–æ–∫:**
1. "–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏"
2. "–ó–∞–ø—Ä–æ—Å –ø–æ–≥–æ–¥—ã –¥–ª—è: Moscow"
3. "–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"
4. (–ø–∞—É–∑–∞, –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
5. "–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω"
6. "–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã"
7. "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞"

**–û–±—ä—è—Å–Ω–µ–Ω–∏—è:**
1. `fetch` ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–¥
2. `.then` –∫–æ–ª–±—ç–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Microtask Queue –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
3. `setTimeout` –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Callback Queue
4. Microtask Queue –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ Callback Queue
</details>

---

### –ó–∞–¥–∞–Ω–∏–µ 2.2.4.3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

–ï—Å—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–≥–æ–¥—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

```javascript
const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á'; // –ü–æ–ª—É—á–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ https://openweathermap.org/api
const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

async function loadCities() {
  console.log('Start');

  const moscow = await fetch(`${API_URL}?q=Moscow&appid=${API_KEY}&units=metric&lang=ru`);
  console.log('Moscow loaded');

  const spb = await fetch(`${API_URL}?q=Saint Petersburg&appid=${API_KEY}&units=metric&lang=ru`);
  console.log('SPB loaded');

  const kazan = await fetch(`${API_URL}?q=Kazan&appid=${API_KEY}&units=metric&lang=ru`);
  console.log('Kazan loaded');

  console.log('All loaded');
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è (–º–µ–¥–ª–µ–Ω–Ω–æ).

**–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–µ–¥–µ–ª–∞–π –∫–æ–¥ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `Promise.all`.

<details>
<summary>üí° –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á';
const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

async function loadCities() {
  console.log('Start');

  const [moscow, spb, kazan] = await Promise.all([
    fetch(`${API_URL}?q=Moscow&appid=${API_KEY}&units=metric&lang=ru`),
    fetch(`${API_URL}?q=Saint Petersburg&appid=${API_KEY}&units=metric&lang=ru`),
    fetch(`${API_URL}?q=Kazan&appid=${API_KEY}&units=metric&lang=ru`)
  ]);

  console.log('Moscow loaded');
  console.log('SPB loaded');
  console.log('Kazan loaded');
  console.log('All loaded');
}
```

**–ü–æ—á–µ–º—É –±—ã—Å—Ç—Ä–µ–µ?**
- –í—Å–µ —Ç—Ä–∏ `fetch` –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- `Promise.all` –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–º–∏—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –û–±—â–µ–µ –≤—Ä–µ–º—è = –≤—Ä–µ–º—è —Å–∞–º–æ–≥–æ –¥–æ–ª–≥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–µ —Å—É–º–º–∞ –≤—Å–µ—Ö)
</details>

---

### –ó–∞–¥–∞–Ω–∏–µ 2.2.4.4: Debounce –¥–ª—è –ø–æ–∏—Å–∫–∞

–°–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é `debounce`, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏.

**–ó–∞–¥–∞—á–∞:** –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –≤–≤–æ–¥–µ –∑–∞–ø—Ä–æ—Å –∫ API –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ 500ms –ø–æ—Å–ª–µ **–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ** –≤–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞.

**–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–¥:**

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debounce - –ü–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .search-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    input:focus {
      outline: none;
      border-color: #4fc3f7;
    }
    .status {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #e3f2fd;
      border-radius: 4px;
      display: none;
    }
    .loading {
      color: #ff9800;
    }
    .counter {
      margin-top: 10px;
      font-size: 12px;
      color: #999;
    }
  </style>
</head>
<body>
  <div class="search-container">
    <h2>–ü–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã —Å Debounce</h2>
    <input
      type="text"
      id="search"
      placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (Moscow, London, Paris...)"
    >
    <div class="status" id="status"></div>
    <div class="result" id="result"></div>
    <div class="counter" id="counter">API –∑–∞–ø—Ä–æ—Å–æ–≤: 0</div>
  </div>

  <script>
    const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á'; // –ü–æ–ª—É—á–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ https://openweathermap.org/api
    const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

    let requestCount = 0;

    // TODO: –†–µ–∞–ª–∏–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é debounce
    function debounce(func, delay) {
      // –¢–≤–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–¥–µ—Å—å
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ–≥–æ–¥—ã
    async function searchWeather(city) {
      if (!city.trim()) {
        document.getElementById('status').textContent = '';
        document.getElementById('result').style.display = 'none';
        return;
      }

      requestCount++;
      document.getElementById('counter').textContent = `API –∑–∞–ø—Ä–æ—Å–æ–≤: ${requestCount}`;
      document.getElementById('status').innerHTML = '<span class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</span>';
      document.getElementById('result').style.display = 'none';

      try {
        const response = await fetch(
          `${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`
        );

        if (!response.ok) {
          throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }

        const data = await response.json();

        document.getElementById('status').textContent = '‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã';
        document.getElementById('result').innerHTML = `
          <h3>${data.name}, ${data.sys.country}</h3>
          <p><strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong> ${Math.round(data.main.temp)}¬∞C</p>
          <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${data.weather[0].description}</p>
          <p><strong>–í–ª–∞–∂–Ω–æ—Å—Ç—å:</strong> ${data.main.humidity}%</p>
        `;
        document.getElementById('result').style.display = 'block';
      } catch (error) {
        document.getElementById('status').textContent = '‚ùå ' + error.message;
      }
    }

    // TODO: –°–æ–∑–¥–∞–π debounced –≤–µ—Ä—Å–∏—é —Ñ—É–Ω–∫—Ü–∏–∏ searchWeather
    // const debouncedSearch = ...

    // TODO: –ü—Ä–∏–≤—è–∂–∏ debouncedSearch –∫ input —Å–æ–±—ã—Ç–∏—é
    document.getElementById('search').addEventListener('input', (e) => {
      // –¢–≤–æ–π –∫–æ–¥ –∑–¥–µ—Å—å
    });
  </script>
</body>
</html>
```

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞</summary>

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debounce - –ü–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .search-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    input:focus {
      outline: none;
      border-color: #4fc3f7;
    }
    .status {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #e3f2fd;
      border-radius: 4px;
      display: none;
    }
    .loading {
      color: #ff9800;
    }
    .counter {
      margin-top: 10px;
      font-size: 12px;
      color: #999;
    }
  </style>
</head>
<body>
  <div class="search-container">
    <h2>–ü–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã —Å Debounce</h2>
    <input
      type="text"
      id="search"
      placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (Moscow, London, Paris...)"
    >
    <div class="status" id="status"></div>
    <div class="result" id="result"></div>
    <div class="counter" id="counter">API –∑–∞–ø—Ä–æ—Å–æ–≤: 0</div>
  </div>

  <script>
    const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á'; // –ü–æ–ª—É—á–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ https://openweathermap.org/api
    const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

    let requestCount = 0;

    // –§—É–Ω–∫—Ü–∏—è debounce
    function debounce(func, delay) {
      let timeoutId;

      return function(...args) {
        // –û—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
        clearTimeout(timeoutId);

        // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
        timeoutId = setTimeout(() => {
          func.apply(this, args);
        }, delay);
      };
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ–≥–æ–¥—ã
    async function searchWeather(city) {
      if (!city.trim()) {
        document.getElementById('status').textContent = '';
        document.getElementById('result').style.display = 'none';
        return;
      }

      requestCount++;
      document.getElementById('counter').textContent = `API –∑–∞–ø—Ä–æ—Å–æ–≤: ${requestCount}`;
      document.getElementById('status').innerHTML = '<span class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</span>';
      document.getElementById('result').style.display = 'none';

      try {
        const response = await fetch(
          `${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`
        );

        if (!response.ok) {
          throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }

        const data = await response.json();

        document.getElementById('status').textContent = '‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã';
        document.getElementById('result').innerHTML = `
          <h3>${data.name}, ${data.sys.country}</h3>
          <p><strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong> ${Math.round(data.main.temp)}¬∞C</p>
          <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${data.weather[0].description}</p>
          <p><strong>–í–ª–∞–∂–Ω–æ—Å—Ç—å:</strong> ${data.main.humidity}%</p>
        `;
        document.getElementById('result').style.display = 'block';
      } catch (error) {
        document.getElementById('status').textContent = '‚ùå ' + error.message;
      }
    }

    // –°–æ–∑–¥–∞—ë–º debounced –≤–µ—Ä—Å–∏—é —Ñ—É–Ω–∫—Ü–∏–∏
    const debouncedSearch = debounce(searchWeather, 500);

    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ input
    document.getElementById('search').addEventListener('input', (e) => {
      debouncedSearch(e.target.value);
    });
  </script>
</body>
</html>
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç debounce:**
1. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤–≤–æ–¥–µ —Å–∏–º–≤–æ–ª–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∏–π `setTimeout`
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä –Ω–∞ 500ms
3. –ó–∞–ø—Ä–æ—Å –∫ API –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ 500ms –±–µ–∑ –Ω–æ–≤—ã—Ö –≤–≤–æ–¥–æ–≤
4. –°—á—ë—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

**–ü—Ä–æ–≤–µ—Ä—å:** –ë—ã—Å—Ç—Ä–æ –Ω–∞–±–µ—Ä–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ ‚Äî –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!
</details>

---

### –ó–∞–¥–∞–Ω–∏–µ 2.2.4.5: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Event Loop

–°–æ–∑–¥–∞–π –ø—Ä–æ—Å—Ç—É—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é Event Loop:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Event Loop –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1e1e1e;
      color: #fff;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    .queue {
      background: #2d2d2d;
      padding: 15px;
      border-radius: 8px;
      min-height: 200px;
    }
    .queue h3 {
      margin-top: 0;
      color: #4fc3f7;
    }
    .task {
      background: #424242;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .controls {
      margin-bottom: 20px;
    }
    button {
      padding: 10px 20px;
      margin-right: 10px;
      background: #4fc3f7;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: #000;
      font-weight: bold;
    }
    button:hover {
      background: #29b6f6;
    }
    #log {
      background: #2d2d2d;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-entry {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1>Event Loop –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</h1>

  <div class="controls">
    <button onclick="addSync()">–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥</button>
    <button onclick="addTimeout()">setTimeout</button>
    <button onclick="addPromise()">Promise</button>
    <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å</button>
  </div>

  <div class="container">
    <div class="queue">
      <h3>Call Stack</h3>
      <div id="call-stack"></div>
    </div>

    <div class="queue">
      <h3>Microtask Queue</h3>
      <div id="microtask-queue"></div>
    </div>

    <div class="queue">
      <h3>Callback Queue</h3>
      <div id="callback-queue"></div>
    </div>
  </div>

  <div id="log">
    <h3>–õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h3>
  </div>

  <script>
    let taskId = 0;

    function log(message) {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function addSync() {
      log('–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
    }

    function addTimeout() {
      const id = ++taskId;
      log(`setTimeout #${id} –∑–∞–ø—É—â–µ–Ω`);

      // –î–æ–±–∞–≤–ª—è–µ–º –≤ Callback Queue –≤–∏–∑—É–∞–ª—å–Ω–æ
      setTimeout(() => {
        const queue = document.getElementById('callback-queue');
        const task = document.createElement('div');
        task.className = 'task';
        task.textContent = `Task #${id}`;
        queue.appendChild(task);

        // –ß–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É "–≤—ã–ø–æ–ª–Ω—è–µ–º"
        setTimeout(() => {
          task.remove();
          log(`setTimeout #${id} –≤—ã–ø–æ–ª–Ω–µ–Ω`);
        }, 1000);
      }, 500);
    }

    function addPromise() {
      const id = ++taskId;
      log(`Promise #${id} —Å–æ–∑–¥–∞–Ω`);

      Promise.resolve().then(() => {
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ Microtask Queue –≤–∏–∑—É–∞–ª—å–Ω–æ
        const queue = document.getElementById('microtask-queue');
        const task = document.createElement('div');
        task.className = 'task';
        task.textContent = `Microtask #${id}`;
        queue.appendChild(task);

        // –ß–µ—Ä–µ–∑ 500ms "–≤—ã–ø–æ–ª–Ω—è–µ–º"
        setTimeout(() => {
          task.remove();
          log(`Promise #${id} –≤—ã–ø–æ–ª–Ω–µ–Ω`);
        }, 500);
      });
    }

    function clearAll() {
      document.getElementById('call-stack').innerHTML = '';
      document.getElementById('microtask-queue').innerHTML = '';
      document.getElementById('callback-queue').innerHTML = '';
      document.getElementById('log').innerHTML = '<h3>–õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h3>';
    }
  </script>
</body>
</html>
```

**–ó–∞–¥–∞—á–∞:** –ü–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏ –Ω–∞–±–ª—é–¥–∞–π, –∫–∞–∫ –∑–∞–¥–∞—á–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ä–∞–∑–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏.

---

## üèÜ –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2.2.4

**–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏** –¥–ª—è –ø–æ–≥–æ–¥–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1. **–¢—Ä–∏ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   - `urgent` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É (queueMicrotask) ‚Äî –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω
   - `normal` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ microtasks (setTimeout 0) ‚Äî —Å–∏–Ω–∏–π —Ñ–æ–Ω
   - `low` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (setTimeout 1000) ‚Äî —Å–µ—Ä—ã–π —Ñ–æ–Ω

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
   - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - –ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Event Loop

3. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
   - –ü–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–∏—Å–∫–æ–º –≥–æ—Ä–æ–¥–∞
   - –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - –ü–∞–Ω–µ–ª—å —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
   - –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è Event Loop

**–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–¥:**

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–æ–≥–æ–¥–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .weather-app {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      margin-bottom: 20px;
    }
    h1 {
      color: #667eea;
      margin-bottom: 20px;
    }
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    input {
      flex: 1;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
    }
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-search {
      background: #667eea;
      color: white;
    }
    .btn-search:hover {
      background: #5568d3;
    }
    .test-buttons {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    .btn-urgent {
      background: #f44336;
      color: white;
    }
    .btn-normal {
      background: #2196f3;
      color: white;
    }
    .btn-low {
      background: #9e9e9e;
      color: white;
    }
    .notifications-panel {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      min-height: 100px;
    }
    .notification {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    .notification.urgent {
      background: #ffebee;
      border-left: 4px solid #f44336;
    }
    .notification.normal {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
    }
    .notification.low {
      background: #f5f5f5;
      border-left: 4px solid #9e9e9e;
    }
    .notification .close {
      cursor: pointer;
      font-weight: bold;
      color: #999;
    }
    .event-log {
      background: #263238;
      color: #4fc3f7;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-entry {
      margin: 2px 0;
    }
    .log-urgent { color: #ff5252; }
    .log-normal { color: #2196f3; }
    .log-low { color: #9e9e9e; }
  </style>
</head>
<body>
  <div class="container">
    <div class="weather-app">
      <h1>üå§Ô∏è –ü–æ–≥–æ–¥–∞ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏</h1>

      <div class="search-box">
        <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ (Moscow, London...)">
        <button class="btn-search" onclick="searchWeather()">–ü–æ–∏—Å–∫</button>
      </div>

      <div class="test-buttons">
        <button class="btn-urgent" onclick="testUrgent()">‚ö° Urgent</button>
        <button class="btn-normal" onclick="testNormal()">üì¢ Normal</button>
        <button class="btn-low" onclick="testLow()">üí§ Low</button>
      </div>

      <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</h3>
      <div class="notifications-panel" id="notificationsPanel">
        <p style="color: #999;">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</p>
      </div>

      <h3>Event Loop Log:</h3>
      <div class="event-log" id="eventLog"></div>
    </div>
  </div>

  <script>
    const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á'; // –ü–æ–ª—É—á–∏ –∫–ª—é—á –Ω–∞ https://openweathermap.org/api
    const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

    // TODO: –†–µ–∞–ª–∏–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é createNotificationSystem
    function createNotificationSystem() {
      // –¢–≤–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–¥–µ—Å—å
      // –î–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–æ–¥–∞–º–∏:
      // - notify(message, priority, type) - —Å–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      // - cancel(id) - –æ—Ç–º–µ–Ω–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    }

    const notifier = createNotificationSystem();

    function log(message, priority = 'normal') {
      const logDiv = document.getElementById('eventLog');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${priority}`;
      const time = new Date().toLocaleTimeString();
      entry.textContent = `[${time}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    async function searchWeather() {
      const city = document.getElementById('cityInput').value.trim();
      if (!city) return;

      log('–ù–∞—á–∞—Ç –ø–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞: ' + city);
      notifier.notify(`–ü–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã –¥–ª—è ${city}...`, 'normal', 'info');

      try {
        const response = await fetch(
          `${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`
        );

        if (!response.ok) {
          throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }

        const data = await response.json();
        notifier.notify(
          `${data.name}: ${Math.round(data.main.temp)}¬∞C, ${data.weather[0].description}`,
          'urgent',
          'success'
        );
        log(`–ü–æ–ª—É—á–µ–Ω–∞ –ø–æ–≥–æ–¥–∞ –¥–ª—è ${city}`, 'urgent');
      } catch (error) {
        notifier.notify('–û—à–∏–±–∫–∞: ' + error.message, 'urgent', 'error');
        log('–û—à–∏–±–∫–∞: ' + error.message, 'urgent');
      }
    }

    function testUrgent() {
      log('–¢–µ—Å—Ç URGENT —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (queueMicrotask)');
      notifier.notify('–°—Ä–æ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ.', 'urgent', 'warning');
    }

    function testNormal() {
      log('–¢–µ—Å—Ç NORMAL —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (setTimeout 0)');
      notifier.notify('–û–±—ã—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ microtasks.', 'normal', 'info');
    }

    function testLow() {
      log('–¢–µ—Å—Ç LOW —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (setTimeout 1000)');
      notifier.notify('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º. –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞.', 'low', 'info');
    }
  </script>
</body>
</html>
```

<details>
<summary>üí° –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ</summary>

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–æ–≥–æ–¥–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .weather-app {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      margin-bottom: 20px;
    }
    h1 {
      color: #667eea;
      margin-bottom: 20px;
    }
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    input {
      flex: 1;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
    }
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-search {
      background: #667eea;
      color: white;
    }
    .btn-search:hover {
      background: #5568d3;
    }
    .test-buttons {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    .btn-urgent {
      background: #f44336;
      color: white;
    }
    .btn-normal {
      background: #2196f3;
      color: white;
    }
    .btn-low {
      background: #9e9e9e;
      color: white;
    }
    .notifications-panel {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      min-height: 100px;
    }
    .notification {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: translateX(100%);
      }
    }
    .notification.urgent {
      background: #ffebee;
      border-left: 4px solid #f44336;
    }
    .notification.normal {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
    }
    .notification.low {
      background: #f5f5f5;
      border-left: 4px solid #9e9e9e;
    }
    .notification .close {
      cursor: pointer;
      font-weight: bold;
      color: #999;
      padding: 0 8px;
    }
    .notification .close:hover {
      color: #333;
    }
    .event-log {
      background: #263238;
      color: #4fc3f7;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-entry {
      margin: 2px 0;
    }
    .log-urgent { color: #ff5252; }
    .log-normal { color: #2196f3; }
    .log-low { color: #9e9e9e; }
  </style>
</head>
<body>
  <div class="container">
    <div class="weather-app">
      <h1>üå§Ô∏è –ü–æ–≥–æ–¥–∞ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏</h1>

      <div class="search-box">
        <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ (Moscow, London...)">
        <button class="btn-search" onclick="searchWeather()">–ü–æ–∏—Å–∫</button>
      </div>

      <div class="test-buttons">
        <button class="btn-urgent" onclick="testUrgent()">‚ö° Urgent (Microtask)</button>
        <button class="btn-normal" onclick="testNormal()">üì¢ Normal (Callback)</button>
        <button class="btn-low" onclick="testLow()">üí§ Low (Delayed)</button>
      </div>

      <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</h3>
      <div class="notifications-panel" id="notificationsPanel">
        <p style="color: #999;">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</p>
      </div>

      <h3>Event Loop Log:</h3>
      <div class="event-log" id="eventLog"></div>
    </div>
  </div>

  <script>
    const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á'; // –ü–æ–ª—É—á–∏ –∫–ª—é—á –Ω–∞ https://openweathermap.org/api
    const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

    function createNotificationSystem() {
      const notifications = new Map();
      let notificationId = 0;

      function showNotification(id, message, priority) {
        const panel = document.getElementById('notificationsPanel');

        // –£–¥–∞–ª—è–µ–º placeholder
        if (panel.querySelector('p')) {
          panel.innerHTML = '';
        }

        const notification = document.createElement('div');
        notification.className = `notification ${priority}`;
        notification.id = `notification-${id}`;
        notification.innerHTML = `
          <span>${message}</span>
          <span class="close" onclick="notifier.cancel(${id})">‚úï</span>
        `;

        panel.appendChild(notification);

        // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
          removeNotification(id);
        }, 3000);
      }

      function removeNotification(id) {
        const notification = document.getElementById(`notification-${id}`);
        if (notification) {
          notification.style.animation = 'fadeOut 0.3s ease-out';
          setTimeout(() => {
            notification.remove();
            const panel = document.getElementById('notificationsPanel');
            if (panel.children.length === 0) {
              panel.innerHTML = '<p style="color: #999;">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</p>';
            }
          }, 300);
        }
      }

      return {
        notify(message, priority = 'normal') {
          const id = ++notificationId;

          if (priority === 'urgent') {
            queueMicrotask(() => {
              log(`[URGENT] ${message}`, 'urgent');
              showNotification(id, message, 'urgent');
            });
          } else if (priority === 'normal') {
            const timeoutId = setTimeout(() => {
              log(`[NORMAL] ${message}`, 'normal');
              showNotification(id, message, 'normal');
              notifications.delete(id);
            }, 0);
            notifications.set(id, timeoutId);
          } else if (priority === 'low') {
            const timeoutId = setTimeout(() => {
              log(`[LOW] ${message}`, 'low');
              showNotification(id, message, 'low');
              notifications.delete(id);
            }, 1000);
            notifications.set(id, timeoutId);
          }

          return id;
        },

        cancel(id) {
          const timeoutId = notifications.get(id);
          if (timeoutId) {
            clearTimeout(timeoutId);
            notifications.delete(id);
            removeNotification(id);
            log(`–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ #${id} –æ—Ç–º–µ–Ω–µ–Ω–æ`, 'normal');
            return true;
          }
          removeNotification(id);
          return false;
        }
      };
    }

    const notifier = createNotificationSystem();

    function log(message, priority = 'normal') {
      const logDiv = document.getElementById('eventLog');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${priority}`;
      const time = new Date().toLocaleTimeString();
      entry.textContent = `[${time}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    async function searchWeather() {
      const city = document.getElementById('cityInput').value.trim();
      if (!city) return;

      log('–ù–∞—á–∞—Ç –ø–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞: ' + city);
      notifier.notify(`–ü–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã –¥–ª—è ${city}...`, 'normal');

      try {
        const response = await fetch(
          `${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`
        );

        if (!response.ok) {
          throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }

        const data = await response.json();
        notifier.notify(
          `${data.name}: ${Math.round(data.main.temp)}¬∞C, ${data.weather[0].description}`,
          'urgent'
        );
        log(`–ü–æ–ª—É—á–µ–Ω–∞ –ø–æ–≥–æ–¥–∞ –¥–ª—è ${city}`, 'urgent');
      } catch (error) {
        notifier.notify('–û—à–∏–±–∫–∞: ' + error.message, 'urgent');
        log('–û—à–∏–±–∫–∞: ' + error.message, 'urgent');
      }
    }

    function testUrgent() {
      log('‚Üí –¢–µ—Å—Ç URGENT (queueMicrotask)', 'urgent');
      notifier.notify('‚ö° –°—Ä–æ—á–Ω–æ–µ! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ Microtask Queue', 'urgent');
      log('‚Üí –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –ø–æ—Å–ª–µ urgent', 'normal');
    }

    function testNormal() {
      log('‚Üí –¢–µ—Å—Ç NORMAL (setTimeout 0)', 'normal');
      notifier.notify('üì¢ –û–±—ã—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–∑ Callback Queue', 'normal');
      log('‚Üí –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –ø–æ—Å–ª–µ normal', 'normal');
    }

    function testLow() {
      log('‚Üí –¢–µ—Å—Ç LOW (setTimeout 1000)', 'low');
      notifier.notify('üí§ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç. –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫', 'low');
      log('‚Üí –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –ø–æ—Å–ª–µ low', 'normal');
    }

    // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    log('=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Event Loop ===');
    log('1. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥');
    testUrgent();
    testNormal();
    testLow();
    log('2. –ö–æ–Ω–µ—Ü —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞');
    log('3. –°–µ–π—á–∞—Å –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è microtasks (urgent)');
    log('4. –ó–∞—Ç–µ–º callbacks (normal, low)');
  </script>
</body>
</html>
```

**–ß—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–µ—à–µ–Ω–∏–µ:**

1. **Event Loop –≤ –¥–µ–π—Å—Ç–≤–∏–∏:**
   - `urgent` (queueMicrotask) ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
   - `normal` (setTimeout 0) ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö microtasks
   - `low` (setTimeout 1000) ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π

2. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
   - –õ–æ–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ –ø–æ–∫–∞–∑–∞

3. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
   - –†–µ–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã —á–µ—Ä–µ–∑ API
   - –†–∞–∑–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
   - –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏

**–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç:**
–ù–∞–∂–º–∏ –≤—Å–µ —Ç—Ä–∏ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ä—è–¥ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏ –≤ –ª–æ–≥ ‚Äî —É–≤–∏–¥–∏—à—å —Ç–æ—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Event Loop!

</details>

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–π —Ç–µ–º—ã —Ç—ã –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å:

- [ ] –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ —Ç–∞–∫–æ–µ Event Loop
- [ ] –ü–æ–Ω–∏–º–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É Call Stack, Callback Queue –∏ Microtask Queue
- [ ] –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- [ ] –û–±—ä—è—Å–Ω–∏—Ç—å, –ø–æ—á–µ–º—É `setTimeout(fn, 0)` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- [ ] –ü–æ–Ω–∏–º–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –º–∏–∫—Ä–æ–∑–∞–¥–∞—á –Ω–∞–¥ –æ–±—ã—á–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
- [ ] –ó–Ω–∞—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `await` —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è Event Loop
- [ ] –ò–∑–±–µ–≥–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ Event Loop
- [ ] –ü—Ä–∏–º–µ–Ω—è—Ç—å –∑–Ω–∞–Ω–∏—è –æ–± Event Loop –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞

---

## üîó –†–µ—Å—É—Ä—Å—ã

**–°—Ç–∞—Ç—å–∏:**
- [Event Loop ‚Äî JavaScript.ru](https://learn.javascript.ru/event-loop)
- [MDN: Concurrency model and Event Loop](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)
- [Philip Roberts: What the heck is the event loop anyway?](https://www.youtube.com/watch?v=8aGhZQkoFbQ) ‚Äî –ª—É—á—à–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

**–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- [Loupe ‚Äî Event Loop Visualizer](http://latentflip.com/loupe/) ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Event Loop
- [JavaScript Visualizer](https://www.jsv9000.app/) ‚Äî –ø–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞

**–í–∏–¥–µ–æ:**
- [Event Loop ‚Äî –í–ª–∞–¥–∏–ª–µ–Ω –ú–∏–Ω–∏–Ω](https://www.youtube.com/watch?v=vIZs5tH-HGQ)
- [Jake Archibald: In The Loop](https://www.youtube.com/watch?v=cCOL7MC4Pl0) ‚Äî –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

---

‚è± **–í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ**: 4-6 —á–∞—Å–æ–≤

---

**–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Ç–µ–º–∞:** [2.2.4 –†–∞–±–æ—Ç–∞ —Å API (fetch)](./2.2.4-–†–∞–±–æ—Ç–∞-—Å-API.md)

**–°–ª–µ–¥—É—é—â–∞—è —Ç–µ–º–∞:** [2.2.6 –ú–æ–¥—É–ª–∏ (ES6+)](./2.2.6-–ú–æ–¥—É–ª–∏.md)

---

> ## üöÄ –£—Å–∫–æ—Ä—è–µ–º –∫–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
>
> **–ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ –¥–ª—è Fullstack-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**
>
> - 7 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å
> - –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø–æ –∫–æ–¥—É –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
> - –ú–∞–∫—Å–∏–º—É–º –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö
>
> [**–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –º–µ–Ω—Ç–æ—Ä–∞—Ö, –æ–±—É—á–µ–Ω–∏–∏ –∏ –∫–µ–π—Å–∞—Ö ‚Üí**](—Å—Å—ã–ª–∫–∞)

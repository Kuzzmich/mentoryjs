# 2.2.7 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞. –û—à–∏–±–∫–∏ –Ω–µ–∏–∑–±–µ–∂–Ω—ã, –≤–∞–∂–Ω–æ –∏—Ö –ø—Ä–µ–¥–≤–∏–¥–µ—Ç—å, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ –¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å.

---

## üéØ –ß—Ç–æ —Ç—ã —É–∑–Ω–∞–µ—à—å

- –ß—Ç–æ —Ç–∞–∫–æ–µ –æ—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- Try/catch/finally –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –æ—à–∏–±–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –ø—Ä–æ–º–∏—Å–∞—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ async/await
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- Graceful degradation (–ø–ª–∞–≤–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è)

---

## üìñ –¢–∏–ø—ã –æ—à–∏–±–æ–∫ –≤ JavaScript

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫

```javascript
// ReferenceError - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –æ–±—ä—è–≤–ª–µ–Ω–∞
console.log(nonExistentVariable);
// ReferenceError: nonExistentVariable is not defined

// TypeError - –æ–ø–µ—Ä–∞—Ü–∏—è —Å –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–º —Ç–∏–ø–æ–º
const number = 42;
number.toUpperCase();
// TypeError: number.toUpperCase is not a function

// SyntaxError - —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
eval('const x = ;');
// SyntaxError: Unexpected token ';'

// RangeError - –∑–Ω–∞—á–µ–Ω–∏–µ –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
const arr = new Array(-1);
// RangeError: Invalid array length

// URIError - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ URI —Ñ—É–Ω–∫—Ü–∏–π
decodeURIComponent('%');
// URIError: URI malformed
```

**–í—Å–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ `Error`.**

---

## üìñ Try/Catch/Finally

### –ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

```javascript
try {
  // –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É
  const result = riskyOperation();
  console.log(result);
} catch (error) {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
  console.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞:', error.message);
} finally {
  // –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞)
  console.log('–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤');
}
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```javascript
function divide(a, b) {
  try {
    if (b === 0) {
      throw new Error('–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ');
    }
    return a / b;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error.message);
    return null;
  } finally {
    console.log('–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }
}

console.log(divide(10, 2)); // 5
// –õ–æ–≥: "–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

console.log(divide(10, 0)); // null
// –õ–æ–≥: "–û—à–∏–±–∫–∞: –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ"
// –õ–æ–≥: "–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
```

**–í–∞–∂–Ω–æ:**
- `try` ‚Äî –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É
- `catch` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ)
- `finally` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å `return` –≤ `try` –∏–ª–∏ `catch`

### Finally –∏ return

```javascript
function test() {
  try {
    return '–∏–∑ try';
  } finally {
    console.log('Finally –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è');
  }
}

console.log(test());
// –í—ã–≤–æ–¥:
// "Finally –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è"
// "–∏–∑ try"
```

**Finally –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å return!**

---

## üìñ Throw - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—à–∏–±–æ–∫

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

```javascript
function validateAge(age) {
  if (typeof age !== 'number') {
    throw new TypeError('–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º');
  }

  if (age < 0) {
    throw new RangeError('–í–æ–∑—Ä–∞—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º');
  }

  if (age < 18) {
    throw new Error('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω –¥–ª—è –ª–∏—Ü –º–ª–∞–¥—à–µ 18 –ª–µ—Ç');
  }

  return true;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
try {
  validateAge('25'); // TypeError
  validateAge(-5);   // RangeError
  validateAge(16);   // Error
  validateAge(20);   // true
} catch (error) {
  console.error(`${error.name}: ${error.message}`);
}
```

### Throw —Å –ª—é–±—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º

```javascript
// –ú–æ–∂–Ω–æ –±—Ä–æ—Å–∏—Ç—å –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
throw '–ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞';
throw 42;
throw { code: 404, message: '–ù–µ –Ω–∞–π–¥–µ–Ω–æ' };

// –ù–æ –ª—É—á—à–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Error
throw new Error('–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏');
```

**–ü–æ—á–µ–º—É Error –ª—É—á—à–µ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è stack trace (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å—Ç–µ–∫–∞)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`name`, `message`, `stack`)
- –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

---

## üìñ –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

### –ë–∞–∑–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å –æ—à–∏–±–∫–∏

```javascript
class ValidationError extends Error {
  constructor(message) {
    super(message);
    this.name = 'ValidationError';
  }
}

function validateUser(user) {
  if (!user.name) {
    throw new ValidationError('–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ');
  }

  if (!user.email) {
    throw new ValidationError('Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω');
  }

  return true;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
try {
  validateUser({ name: 'John' });
} catch (error) {
  if (error instanceof ValidationError) {
    console.error('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', error.message);
  } else {
    console.error('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
  }
}
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ—à–∏–±–∫–∏

```javascript
class HttpError extends Error {
  constructor(message, statusCode) {
    super(message);
    this.name = 'HttpError';
    this.statusCode = statusCode;
  }
}

class NotFoundError extends HttpError {
  constructor(resource) {
    super(`–†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω: ${resource}`, 404);
    this.name = 'NotFoundError';
  }
}

class UnauthorizedError extends HttpError {
  constructor(message = '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è') {
    super(message, 401);
    this.name = 'UnauthorizedError';
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
async function fetchUser(id) {
  const response = await fetch(`/api/users/${id}`);

  if (response.status === 404) {
    throw new NotFoundError(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${id}`);
  }

  if (response.status === 401) {
    throw new UnauthorizedError();
  }

  if (!response.ok) {
    throw new HttpError('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', response.status);
  }

  return await response.json();
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞
try {
  const user = await fetchUser(123);
} catch (error) {
  if (error instanceof NotFoundError) {
    console.error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
  } else if (error instanceof UnauthorizedError) {
    console.error('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
  } else if (error instanceof HttpError) {
    console.error(`HTTP –æ—à–∏–±–∫–∞ ${error.statusCode}: ${error.message}`);
  } else {
    console.error('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
  }
}
```

---

## üìñ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –ø—Ä–æ–º–∏—Å–∞—Ö

### Promise.catch()

```javascript
fetch('https://api.example.com/data')
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => {
    console.error('–û—à–∏–±–∫–∞:', error.message);
  });
```

### –¶–µ–ø–æ—á–∫–∞ catch

```javascript
fetch('https://api.example.com/data')
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    if (!data.results) {
      throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö');
    }
    return data.results;
  })
  .catch(error => {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error.message);
    return []; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  })
  .then(results => {
    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:', results);
  });
```

### Finally –≤ –ø—Ä–æ–º–∏—Å–∞—Ö

```javascript
let isLoading = true;

fetch('https://api.example.com/data')
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error(error))
  .finally(() => {
    isLoading = false;
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  });
```

---

## üìñ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ async/await

### Try/catch —Å async/await

```javascript
async function fetchData() {
  try {
    const response = await fetch('https://api.example.com/data');

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const data = await response.json();
    return data;

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error.message);
    throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–ª—å—à–µ
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
async function main() {
  try {
    const data = await fetchData();
    console.log('–î–∞–Ω–Ω—ã–µ:', data);
  } catch (error) {
    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
  }
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

```javascript
async function loadMultipleResources() {
  const errors = [];
  const results = [];

  try {
    const user = await fetchUser(1);
    results.push(user);
  } catch (error) {
    errors.push({ resource: 'user', error });
  }

  try {
    const posts = await fetchPosts();
    results.push(posts);
  } catch (error) {
    errors.push({ resource: 'posts', error });
  }

  if (errors.length > 0) {
    console.warn('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å:', errors);
  }

  return results;
}
```

### Promise.allSettled –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```javascript
async function loadAllData() {
  const promises = [
    fetchUser(1),
    fetchPosts(),
    fetchComments()
  ];

  const results = await Promise.allSettled(promises);

  results.forEach((result, index) => {
    if (result.status === 'fulfilled') {
      console.log(`–†–µ—Å—É—Ä—Å ${index} –∑–∞–≥—Ä—É–∂–µ–Ω:`, result.value);
    } else {
      console.error(`–†–µ—Å—É—Ä—Å ${index} –æ—à–∏–±–∫–∞:`, result.reason.message);
    }
  });

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  return results
    .filter(r => r.status === 'fulfilled')
    .map(r => r.value);
}
```

---

## üìñ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏

```javascript
class ValidationError extends Error {
  constructor(field, message) {
    super(message);
    this.name = 'ValidationError';
    this.field = field;
  }
}

function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if (!email) {
    throw new ValidationError('email', 'Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω');
  }

  if (typeof email !== 'string') {
    throw new ValidationError('email', 'Email –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π');
  }

  if (!emailRegex.test(email)) {
    throw new ValidationError('email', '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email');
  }

  return true;
}

function validatePassword(password) {
  if (!password) {
    throw new ValidationError('password', '–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω');
  }

  if (password.length < 8) {
    throw new ValidationError('password', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤');
  }

  if (!/[A-Z]/.test(password)) {
    throw new ValidationError('password', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–ª–∞–≤–Ω—É—é –±—É–∫–≤—É');
  }

  if (!/[0-9]/.test(password)) {
    throw new ValidationError('password', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—É');
  }

  return true;
}

function validateUser(user) {
  const errors = {};

  try {
    validateEmail(user.email);
  } catch (error) {
    if (error instanceof ValidationError) {
      errors[error.field] = error.message;
    }
  }

  try {
    validatePassword(user.password);
  } catch (error) {
    if (error instanceof ValidationError) {
      errors[error.field] = error.message;
    }
  }

  if (Object.keys(errors).length > 0) {
    const error = new Error('–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏');
    error.name = 'ValidationErrors';
    error.errors = errors;
    throw error;
  }

  return true;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
try {
  validateUser({
    email: 'invalid-email',
    password: '123'
  });
} catch (error) {
  if (error.name === 'ValidationErrors') {
    console.error('–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:');
    Object.entries(error.errors).forEach(([field, message]) => {
      console.error(`  ${field}: ${message}`);
    });
  }
}
```

---

## üå§Ô∏è –ü—Ä–∞–∫—Ç–∏–∫–∞: –ü–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ó–∞–¥–∞–Ω–∏–µ 2.2.7.1: –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –¥–ª—è API

–°–æ–∑–¥–∞–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –¥–ª—è –ø–æ–≥–æ–¥–Ω–æ–≥–æ API —Å –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**

```
task-2.2.7.1/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ errors.js      # –ö–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ api.js         # API —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ app.js             # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª
```

**–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–¥:**

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ó–∞–¥–∞–Ω–∏–µ 2.2.7.1 - –ö–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      background: #667eea;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #5568d3;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .success {
      background: #d4edda;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –æ—à–∏–±–æ–∫</h1>
    <p>–ù–∞–∂–∏–º–∞–π –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫:</p>

    <button onclick="testSuccess()">‚úÖ –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å</button>
    <button onclick="testNotFound()">‚ùå –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω</button>
    <button onclick="testInvalidKey()">üîë –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á</button>
    <button onclick="testNetwork()">üåê –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞</button>

    <div id="result"></div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
```

```javascript
// modules/errors.js

// TODO: –°–æ–∑–¥–∞–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å WeatherAPIError
// –î–æ–ª–∂–µ–Ω –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç Error
// –ü—Ä–∏–Ω–∏–º–∞—Ç—å message –∏ statusCode

// TODO: –°–æ–∑–¥–∞–π CityNotFoundError
// –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç WeatherAPIError
// –ü—Ä–∏–Ω–∏–º–∞–µ—Ç city, statusCode = 404
// –î–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π—Å—Ç–≤–æ this.city

// TODO: –°–æ–∑–¥–∞–π InvalidAPIKeyError
// –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç WeatherAPIError
// statusCode = 401

// TODO: –°–æ–∑–¥–∞–π RateLimitError
// –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç WeatherAPIError
// statusCode = 429

// TODO: –°–æ–∑–¥–∞–π NetworkError
// –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç Error
// –ü—Ä–∏–Ω–∏–º–∞–µ—Ç originalError

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π –≤—Å–µ –∫–ª–∞—Å—Å—ã
```

```javascript
// modules/api.js

// TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –∏–∑ errors.js

const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á'; // –ü–æ–ª—É—á–∏ –Ω–∞ https://openweathermap.org/api
const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

export async function getWeather(city) {
  try {
    const response = await fetch(
      `${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`
    );

    // TODO: –û–±—Ä–∞–±–æ—Ç–∞–π —Ä–∞–∑–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã:
    // - 404 -> throw new CityNotFoundError(city)
    // - 401 -> throw new InvalidAPIKeyError()
    // - 429 -> throw new RateLimitError()
    // - !response.ok -> throw new WeatherAPIError(message, status)

    const data = await response.json();
    return data;

  } catch (error) {
    // TODO: –û–±—Ä–∞–±–æ—Ç–∞–π —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
    // –ï—Å–ª–∏ error.name === 'TypeError' && error.message.includes('fetch')
    // -> throw new NetworkError(error)

    throw error;
  }
}
```

```javascript
// app.js

// TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π getWeather –∏–∑ modules/api.js
// TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –≤—Å–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –∏–∑ modules/errors.js

function showResult(message, isError = false) {
  const result = document.getElementById('result');
  result.textContent = message;
  result.className = isError ? 'error' : 'success';
}

window.testSuccess = async function() {
  try {
    const weather = await getWeather('Moscow');
    showResult(`‚úÖ –£—Å–ø–µ—Ö!\n–ì–æ—Ä–æ–¥: ${weather.name}\n–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${Math.round(weather.main.temp)}¬∞C`);
  } catch (error) {
    showResult(`‚ùå ${error.name}: ${error.message}`, true);
  }
};

window.testNotFound = async function() {
  try {
    await getWeather('NonExistentCity12345');
  } catch (error) {
    // TODO: –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —ç—Ç–æ CityNotFoundError
    // –ü–æ–∫–∞–∂–∏: `–û—à–∏–±–∫–∞ 404: ${error.city} –Ω–µ –Ω–∞–π–¥–µ–Ω`
    showResult(`‚ùå ${error.name}: ${error.message}`, true);
  }
};

window.testInvalidKey = async function() {
  // TODO: –î–ª—è —Ç–µ—Å—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ —É–∫–∞–∂–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
  showResult('‚ùå –î–ª—è —Ç–µ—Å—Ç–∞ –∏–∑–º–µ–Ω–∏ API_KEY –≤ modules/api.js –Ω–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π', true);
};

window.testNetwork = async function() {
  try {
    // –°–∏–º—É–ª—è—Ü–∏—è —Å–µ—Ç–µ–≤–æ–π –æ—à–∏–±–∫–∏ (–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–º–µ–Ω)
    await getWeather('test');
  } catch (error) {
    // TODO: –ü—Ä–æ–≤–µ—Ä—å —Ç–∏–ø –æ—à–∏–±–∫–∏ –∏ –ø–æ–∫–∞–∂–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    showResult(`‚ùå ${error.name}: ${error.message}`, true);
  }
};
```

<details>
<summary>üí° –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ</summary>

```javascript
// modules/errors.js

// –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ Weather API
export class WeatherAPIError extends Error {
  constructor(message, statusCode) {
    super(message);
    this.name = 'WeatherAPIError';
    this.statusCode = statusCode;
  }
}

// –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
export class CityNotFoundError extends WeatherAPIError {
  constructor(city) {
    super(`–ì–æ—Ä–æ–¥ "${city}" –Ω–µ –Ω–∞–π–¥–µ–Ω`, 404);
    this.name = 'CityNotFoundError';
    this.city = city;
  }
}

// –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
export class InvalidAPIKeyError extends WeatherAPIError {
  constructor() {
    super('–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.', 401);
    this.name = 'InvalidAPIKeyError';
  }
}

// –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
export class RateLimitError extends WeatherAPIError {
  constructor() {
    super('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 429);
    this.name = 'RateLimitError';
  }
}

// –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞
export class NetworkError extends Error {
  constructor(originalError) {
    super('–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
    this.name = 'NetworkError';
    this.originalError = originalError;
  }
}
```

```javascript
// modules/api.js

import {
  WeatherAPIError,
  CityNotFoundError,
  InvalidAPIKeyError,
  RateLimitError,
  NetworkError
} from './errors.js';

const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á';
const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

export async function getWeather(city) {
  try {
    const response = await fetch(
      `${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`
    );

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö HTTP —Å—Ç–∞—Ç—É—Å–æ–≤
    if (response.status === 404) {
      throw new CityNotFoundError(city);
    }

    if (response.status === 401) {
      throw new InvalidAPIKeyError();
    }

    if (response.status === 429) {
      throw new RateLimitError();
    }

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new WeatherAPIError(
        errorData.message || '–û—à–∏–±–∫–∞ API',
        response.status
      );
    }

    const data = await response.json();
    return data;

  } catch (error) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
    if (error.name === 'TypeError' && error.message.includes('fetch')) {
      throw new NetworkError(error);
    }

    throw error;
  }
}
```

```javascript
// app.js

import { getWeather } from './modules/api.js';
import {
  WeatherAPIError,
  CityNotFoundError,
  InvalidAPIKeyError,
  RateLimitError,
  NetworkError
} from './modules/errors.js';

function showResult(message, isError = false) {
  const result = document.getElementById('result');
  result.textContent = message;
  result.className = isError ? 'error' : 'success';
}

window.testSuccess = async function() {
  try {
    const weather = await getWeather('Moscow');
    showResult(
      `‚úÖ –£—Å–ø–µ—Ö!\n` +
      `–ì–æ—Ä–æ–¥: ${weather.name}\n` +
      `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${Math.round(weather.main.temp)}¬∞C\n` +
      `–û–ø–∏—Å–∞–Ω–∏–µ: ${weather.weather[0].description}`
    );
  } catch (error) {
    handleError(error);
  }
};

window.testNotFound = async function() {
  try {
    await getWeather('NonExistentCity12345');
  } catch (error) {
    if (error instanceof CityNotFoundError) {
      showResult(
        `‚ùå –û—à–∏–±–∫–∞ 404\n` +
        `–ì–æ—Ä–æ–¥ "${error.city}" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.\n` +
        `–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è.`,
        true
      );
    } else {
      handleError(error);
    }
  }
};

window.testInvalidKey = async function() {
  showResult(
    '‚ö†Ô∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞:\n' +
    '1. –û—Ç–∫—Ä–æ–π—Ç–µ modules/api.js\n' +
    '2. –í—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ API_KEY –Ω–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π\n' +
    '3. –°–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ —ç—Ç—É –∫–Ω–æ–ø–∫—É\n' +
    '4. –í—ã —É–≤–∏–¥–∏—Ç–µ InvalidAPIKeyError',
    true
  );
};

window.testNetwork = async function() {
  showResult(
    '‚ö†Ô∏è –°–∏–º—É–ª—è—Ü–∏—è —Å–µ—Ç–µ–≤–æ–π –æ—à–∏–±–∫–∏:\n' +
    '1. –û—Ç–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç\n' +
    '2. –ù–∞–∂–º–∏—Ç–µ "–£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å"\n' +
    '3. –í—ã —É–≤–∏–¥–∏—Ç–µ NetworkError',
    true
  );
};

function handleError(error) {
  if (error instanceof CityNotFoundError) {
    showResult(`‚ùå CityNotFoundError: –ì–æ—Ä–æ–¥ "${error.city}" –Ω–µ –Ω–∞–π–¥–µ–Ω`, true);
  } else if (error instanceof InvalidAPIKeyError) {
    showResult(`‚ùå InvalidAPIKeyError: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á`, true);
  } else if (error instanceof RateLimitError) {
    showResult(`‚ùå RateLimitError: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤`, true);
  } else if (error instanceof NetworkError) {
    showResult(`‚ùå NetworkError: –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É`, true);
  } else if (error instanceof WeatherAPIError) {
    showResult(`‚ùå WeatherAPIError (${error.statusCode}): ${error.message}`, true);
  } else {
    showResult(`‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, true);
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (errors, api, app)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –æ—à–∏–±–æ–∫
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

</details>

---

### –ó–∞–¥–∞–Ω–∏–µ 2.2.7.2: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–î–æ–±–∞–≤—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≥–æ—Ä–æ–¥–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ API —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**

```
task-2.2.7.2/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ errors.js       # –ö–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–π –∏–∑ 2.2.7.1)
‚îÇ   ‚îú‚îÄ‚îÄ validation.js   # –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ api.js          # API —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ app.js              # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å UI
```

**–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–¥:**

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ó–∞–¥–∞–Ω–∏–µ 2.2.7.2 - –í–∞–ª–∏–¥–∞—Ü–∏—è</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .search-box {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    input {
      flex: 1;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    input.error {
      border-color: #f44336;
    }
    input.success {
      border-color: #4caf50;
    }
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      background: #667eea;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #5568d3;
    }
    .validation-message {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      font-size: 14px;
    }
    .validation-message.error {
      background: #ffebee;
      color: #c62828;
    }
    .validation-message.success {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .test-cases {
      margin-top: 30px;
      padding: 20px;
      background: #f5f5f5;
      border-radius: 8px;
    }
    .test-case {
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      font-family: monospace;
    }
    .test-case.pass {
      background: #e8f5e9;
    }
    .test-case.fail {
      background: #ffebee;
    }
    #weatherResult {
      margin-top: 20px;
      padding: 20px;
      background: #e3f2fd;
      border-radius: 8px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ –≥–æ—Ä–æ–¥–∞</h1>
    <p>–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:</p>

    <div class="search-box">
      <input
        type="text"
        id="cityInput"
        placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ (Moscow, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥...)"
        autocomplete="off"
      >
      <button id="searchBtn">–ü–æ–∏—Å–∫</button>
    </div>

    <div id="validationMessage" class="validation-message" style="display: none;"></div>
    <div id="weatherResult"></div>

    <div class="test-cases">
      <h3>–ê–≤—Ç–æ—Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏:</h3>
      <button onclick="runTests()" style="margin-bottom: 10px;">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
      <div id="testResults"></div>
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
```

```javascript
// modules/validation.js

// TODO: –°–æ–∑–¥–∞–π –∫–ª–∞—Å—Å InputValidationError
// export class InputValidationError extends Error { ... }

// TODO: –°–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é validateCityInput(city)
// –ü—Ä–æ–≤–µ—Ä–∫–∏:
// 1. –ì–æ—Ä–æ–¥ –Ω–µ –ø—É—Å—Ç–æ–π (–ø–æ—Å–ª–µ trim)
// 2. –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö - —Å—Ç—Ä–æ–∫–∞
// 3. –ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞
// 4. –ú–∞–∫—Å–∏–º—É–º 85 —Å–∏–º–≤–æ–ª–æ–≤
// 5. –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã (–ª—é–±—ã–µ —è–∑—ã–∫–∏), –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å—ã, –∞–ø–æ—Å—Ç—Ä–æ—Ñ—ã
//    Regex: /^[\p{L}\s\-']+$/u
// 6. –ù–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (XSS, SQL injection)
//    –ü—Ä–æ–≤–µ—Ä—å: /<script/i, /javascript:/i, /on\w+=/i, /union.*select/i
//
// –í–æ–∑–≤—Ä–∞—â–∞–π trimmed —Å—Ç—Ä–æ–∫—É –µ—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞
// export function validateCityInput(city) { ... }
```

```javascript
// app.js

// TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –Ω—É–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∫–ª–∞—Å—Å—ã

// TODO: –†–µ–∞–ª–∏–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é showValidationMessage(message, isError)
// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–¥ –∏–Ω–ø—É—Ç–æ–º

// TODO: –†–µ–∞–ª–∏–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é showWeather(data)
// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–≥–æ–¥—ã

// TODO: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∏—Å–∫–∞
document.getElementById('searchBtn').addEventListener('click', async () => {
  const input = document.getElementById('cityInput');
  const city = input.value;

  try {
    // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è
    // const validatedCity = validateCityInput(city);

    // 2. API –∑–∞–ø—Ä–æ—Å
    // const weather = await getWeather(validatedCity);

    // 3. –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

  } catch (error) {
    // –û–±—Ä–∞–±–æ—Ç–∞–π —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
  }
});

// TODO: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–ø—Ä–∏ –≤–≤–æ–¥–µ)
document.getElementById('cityInput').addEventListener('input', (e) => {
  // –ü–æ–ø—Ä–æ–±—É–π –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–∫–∞–∂–∏ feedback
});

// –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã
window.runTests = function() {
  const testCases = [
    { input: '', shouldPass: false, name: '–ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞' },
    { input: 'M', shouldPass: false, name: '–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π' },
    { input: 'Moscow', shouldPass: true, name: '–û–±—ã—á–Ω—ã–π –≥–æ—Ä–æ–¥' },
    { input: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', shouldPass: true, name: '–° –¥–µ—Ñ–∏—Å–æ–º' },
    { input: 'New York', shouldPass: true, name: '–° –ø—Ä–æ–±–µ–ª–æ–º' },
    { input: "Saint-Jean-d'Ang√©ly", shouldPass: true, name: '–° –∞–ø–æ—Å—Ç—Ä–æ—Ñ–æ–º' },
    { input: 'City123', shouldPass: false, name: '–° —Ü–∏—Ñ—Ä–∞–º–∏' },
    { input: '<script>alert(1)</script>', shouldPass: false, name: 'XSS –∞—Ç–∞–∫–∞' },
    { input: 'City; DROP TABLE', shouldPass: false, name: 'SQL injection' },
  ];

  const resultsDiv = document.getElementById('testResults');
  resultsDiv.innerHTML = '';

  testCases.forEach(testCase => {
    // TODO: –ó–∞–ø—É—Å—Ç–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –ø–æ–∫–∞–∂–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    // –ò—Å–ø–æ–ª—å–∑—É–π validateCityInput
  });
};
```

<details>
<summary>üí° –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
class InputValidationError extends Error {
  constructor(message) {
    super(message);
    this.name = 'InputValidationError';
  }
}

function validateCityInput(city) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É
  if (!city || city.trim() === '') {
    throw new InputValidationError('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
  if (typeof city !== 'string') {
    throw new InputValidationError('–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–µ–∫—Å—Ç–æ–º');
  }

  // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –ø–æ –∫—Ä–∞—è–º
  const trimmedCity = city.trim();

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã
  if (trimmedCity.length < 2) {
    throw new InputValidationError('–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã
  if (trimmedCity.length > 85) {
    throw new InputValidationError('–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ');
  }

  // –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã (–ª—é–±—ã–µ —è–∑—ã–∫–∏), –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å—ã –∏ –∞–ø–æ—Å—Ç—Ä–æ—Ñ—ã
  const validNameRegex = /^[\p{L}\s\-']+$/u;

  if (!validNameRegex.test(trimmedCity)) {
    throw new InputValidationError('–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (SQL injection, XSS)
  const suspiciousPatterns = [
    /<script/i,
    /javascript:/i,
    /on\w+=/i,
    /union.*select/i,
    /drop.*table/i
  ];

  for (const pattern of suspiciousPatterns) {
    if (pattern.test(trimmedCity)) {
      throw new InputValidationError('–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã');
    }
  }

  return trimmedCity;
}

// –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
const testCases = [
  '',                          // –û—à–∏–±–∫–∞: –ø—É—Å—Ç–æ–π
  'M',                         // –û—à–∏–±–∫–∞: —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
  'Moscow',                    // OK
  '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',          // OK
  "Saint-Jean-d'Ang√©ly",      // OK (—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –≥–æ—Ä–æ–¥ —Å –¥–µ—Ñ–∏—Å–æ–º –∏ –∞–ø–æ—Å—Ç—Ä–æ—Ñ–æ–º)
  'New York',                  // OK
  'City123',                   // –û—à–∏–±–∫–∞: —Ü–∏—Ñ—Ä—ã
  '<script>alert(1)</script>', // –û—à–∏–±–∫–∞: XSS
  'City; DROP TABLE cities',   // –û—à–∏–±–∫–∞: SQL injection
];

testCases.forEach(testCity => {
  try {
    const validated = validateCityInput(testCity);
    console.log(`‚úÖ "${testCity}" -> "${validated}"`);
  } catch (error) {
    console.log(`‚ùå "${testCity}" -> ${error.message}`);
  }
});
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**

```javascript
document.getElementById('searchBtn').addEventListener('click', async () => {
  const input = document.getElementById('cityInput').value;

  try {
    // –°–Ω–∞—á–∞–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
    const city = validateCityInput(input);

    // –ó–∞—Ç–µ–º –∑–∞–ø—Ä–æ—Å
    showLoading();
    const weather = await getWeather(city);
    showWeather(weather);

  } catch (error) {
    if (error instanceof InputValidationError) {
      showError(error.message);
    } else if (error instanceof CityNotFoundError) {
      showError(`–ì–æ—Ä–æ–¥ "${error.city}" –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.`);
    } else if (error instanceof NetworkError) {
      showError('–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.');
    } else {
      showError('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
      console.error(error);
    }
  } finally {
    hideLoading();
  }
});
```

</details>

---

### –ó–∞–¥–∞–Ω–∏–µ 2.2.7.3: Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

–†–µ–∞–ª–∏–∑—É–π –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö.

**–ó–∞–¥–∞—á–∞:** –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ —É–¥–∞–ª—Å—è –∏–∑-–∑–∞ —Å–µ—Ç–µ–≤–æ–π –æ—à–∏–±–∫–∏ –∏–ª–∏ 5xx —Å—Ç–∞—Ç—É—Å–∞, –ø–æ–≤—Ç–æ—Ä–∏ –∑–∞–ø—Ä–æ—Å –¥–æ 3 —Ä–∞–∑ —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–µ–π—Å—è –∑–∞–¥–µ—Ä–∂–∫–æ–π (1—Å, 2—Å, 4—Å).

**–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–¥:**

```javascript
// TODO: –†–µ–∞–ª–∏–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
async function retryWithBackoff(fn, maxRetries = 3) {
  // –¢–≤–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
async function getWeatherWithRetry(city) {
  return retryWithBackoff(() => getWeather(city));
}
```

<details>
<summary>üí° –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
/**
 * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∏ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
 * @param {Function} fn - Async —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
 * @param {number} maxRetries - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
 * @param {number} baseDelay - –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –º—Å (—É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è —Å –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–æ–π)
 */
async function retryWithBackoff(fn, maxRetries = 3, baseDelay = 1000) {
  let lastError;

  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      // –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
      const result = await fn();

      // –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞, –ª–æ–≥–∏—Ä—É–µ–º
      if (attempt > 0) {
        console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ—Å–ª–µ ${attempt + 1} –ø–æ–ø—ã—Ç–æ–∫`);
      }

      return result;

    } catch (error) {
      lastError = error;

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—Ç–æ–∏—Ç –ª–∏ –ø–æ–≤—Ç–æ—Ä—è—Ç—å
      const shouldRetry =
        error instanceof NetworkError ||
        (error instanceof WeatherAPIError && error.statusCode >= 500);

      // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –∏–ª–∏ –Ω–µ —Å—Ç–æ–∏—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å
      if (attempt === maxRetries || !shouldRetry) {
        throw error;
      }

      // –í—ã—á–∏—Å–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É: 1s, 2s, 4s, 8s...
      const delay = baseDelay * Math.pow(2, attempt);

      console.log(
        `‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries + 1} –Ω–µ —É–¥–∞–ª–∞—Å—å. ` +
        `–ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${delay / 1000}—Å...`
      );

      // –ñ–¥—ë–º –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }

  throw lastError;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å –ø–æ–≥–æ–¥–Ω—ã–º API
async function getWeatherWithRetry(city) {
  return retryWithBackoff(
    () => getWeather(city),
    3,    // –º–∞–∫—Å–∏–º—É–º 3 –ø–æ–≤—Ç–æ—Ä–∞
    1000  // –Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞
  );
}

// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
async function test() {
  try {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã —Å retry...');
    const weather = await getWeatherWithRetry('Moscow');
    console.log(`–ü–æ–≥–æ–¥–∞ –≤ ${weather.name}: ${Math.round(weather.main.temp)}¬∞C`);
  } catch (error) {
    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≥–æ–¥—É –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫:', error.message);
  }
}

test();
```

**–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –≤–µ—Ä—Å–∏—è —Å jitter (—Å–ª—É—á–∞–π–Ω—ã–º —Ä–∞–∑–±—Ä–æ—Å–æ–º):**

```javascript
async function retryWithBackoff(fn, maxRetries = 3, baseDelay = 1000) {
  let lastError;

  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error;

      const shouldRetry =
        error instanceof NetworkError ||
        (error instanceof WeatherAPIError && error.statusCode >= 500);

      if (attempt === maxRetries || !shouldRetry) {
        throw error;
      }

      // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Å jitter
      const exponentialDelay = baseDelay * Math.pow(2, attempt);
      const jitter = Math.random() * 500; // ¬±500ms —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
      const delay = exponentialDelay + jitter;

      console.log(`‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ ${attempt + 1} –Ω–µ —É–¥–∞–ª–∞—Å—å. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${Math.round(delay / 1000)}—Å...`);

      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }

  throw lastError;
}
```

**–ó–∞—á–µ–º –Ω—É–∂–µ–Ω jitter:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –°–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö —Å–±–æ—è—Ö
- –£–ª—É—á—à–∞–µ—Ç —à–∞–Ω—Å—ã –Ω–∞ —É—Å–ø–µ—Ö

</details>

---

## üèÜ –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2.2.7

**–°–æ–∑–¥–∞–π –Ω–∞–¥—ë–∂–Ω–æ–µ –ø–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** —Å –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–æ–¥–∞ –≥–æ—Ä–æ–¥–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è API –∫–ª—é—á–∞

2. **–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:**
   - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
   - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫:**
   - –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
   - –û—à–∏–±–∫–∏ API (404, 401, 429, 5xx)
   - –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –¢–∞–π–º–∞—É—Ç—ã

4. **Retry –º–µ—Ö–∞–Ω–∏–∑–º:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
   - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

5. **UI –¥–ª—è –æ—à–∏–±–æ–∫:**
   - –†–∞–∑–Ω—ã–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ—à–∏–±–æ–∫
   - –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –ö–Ω–æ–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞

6. **Graceful degradation:**
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
   - –ß–∞—Å—Ç–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º

### üìã –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–¥

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```
–∏—Ç–æ–≥–æ–≤–æ–µ-–∑–∞–¥–∞–Ω–∏–µ/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ app.js
‚îî‚îÄ‚îÄ modules/
    ‚îú‚îÄ‚îÄ errors.js
    ‚îú‚îÄ‚îÄ validation.js
    ‚îú‚îÄ‚îÄ api.js
    ‚îú‚îÄ‚îÄ cache.js
    ‚îî‚îÄ‚îÄ ui.js
```

**index.html**
```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–∞–¥—ë–∂–Ω–æ–µ –ø–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .weather-card {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    input {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      width: 70%;
      font-size: 16px;
    }
    button {
      padding: 12px 24px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-left: 10px;
    }
    button:hover {
      background: #0056b3;
    }
    .error {
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .error.validation {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      color: #856404;
    }
    .error.network {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
      color: #721c24;
    }
    .error.not-found {
      background: #d1ecf1;
      border-left: 4px solid #17a2b8;
      color: #0c5460;
    }
    .retry-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    .cached-indicator {
      background: #d4edda;
      color: #155724;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 10px;
    }
    #weatherInfo {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="weather-card">
    <h1>üå§Ô∏è –ù–∞–¥—ë–∂–Ω–∞—è –ø–æ–≥–æ–¥–∞</h1>

    <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥...">
    <button id="searchBtn">–ü–æ–∏—Å–∫</button>

    <div id="errorContainer"></div>
    <div id="weatherInfo"></div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
```

**modules/errors.js**
```javascript
// ============================================
// –°–û–ë–°–¢–í–ï–ù–ù–´–ï –ö–õ–ê–°–°–´ –û–®–ò–ë–û–ö
// ============================================

// TODO: –°–æ–∑–¥–∞–π –∫–ª–∞—Å—Å WeatherAPIError, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç Error
// –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç: message, statusCode
// –£—Å—Ç–∞–Ω–æ–≤–∏:
//   - this.name = 'WeatherAPIError'
//   - this.statusCode = statusCode

// TODO: –°–æ–∑–¥–∞–π –∫–ª–∞—Å—Å CityNotFoundError, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç WeatherAPIError
// –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç: city
// –í—ã–∑–æ–≤–∏ super —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: `–ì–æ—Ä–æ–¥ "${city}" –Ω–µ –Ω–∞–π–¥–µ–Ω`, statusCode = 404
// –£—Å—Ç–∞–Ω–æ–≤–∏:
//   - this.name = 'CityNotFoundError'
//   - this.city = city

// TODO: –°–æ–∑–¥–∞–π –∫–ª–∞—Å—Å NetworkError, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç Error
// –í—ã–∑–æ–≤–∏ super —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: '–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É'
// –£—Å—Ç–∞–Ω–æ–≤–∏ this.name = 'NetworkError'

// TODO: –°–æ–∑–¥–∞–π –∫–ª–∞—Å—Å InputValidationError, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç Error
// –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç: message
// –£—Å—Ç–∞–Ω–æ–≤–∏ this.name = 'InputValidationError'

// TODO: –°–æ–∑–¥–∞–π –∫–ª–∞—Å—Å InvalidAPIKeyError, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç WeatherAPIError
// –í—ã–∑–æ–≤–∏ super —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: '–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á', statusCode = 401
// –£—Å—Ç–∞–Ω–æ–≤–∏ this.name = 'InvalidAPIKeyError'

// TODO: –°–æ–∑–¥–∞–π –∫–ª–∞—Å—Å RateLimitError, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç WeatherAPIError
// –í—ã–∑–æ–≤–∏ super —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: '–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤', statusCode = 429
// –£—Å—Ç–∞–Ω–æ–≤–∏ this.name = 'RateLimitError'

// TODO: –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π –≤—Å–µ –∫–ª–∞—Å—Å—ã
// export { WeatherAPIError, CityNotFoundError, NetworkError, ... }
```

**modules/validation.js**
```javascript
// ============================================
// –í–ê–õ–ò–î–ê–¶–ò–Ø –í–í–û–î–ê
// ============================================

// TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π InputValidationError –∏–∑ './errors.js'

// TODO: –°–æ–∑–¥–∞–π –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π —Ñ—É–Ω–∫—Ü–∏—é validateCityInput(city)
// –ü—Ä–æ–≤–µ—Ä–∫–∏:
// 1. –ï—Å–ª–∏ !city || city.trim() === ''
//    -> throw new InputValidationError('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞')
//
// 2. const trimmed = city.trim()
//
// 3. –ï—Å–ª–∏ trimmed.length < 2
//    -> throw new InputValidationError('–ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞')
//
// 4. –ï—Å–ª–∏ !/^[\p{L}\s\-']+$/u.test(trimmed)
//    -> throw new InputValidationError('–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã')
//
// 5. return trimmed
```

**modules/api.js**
```javascript
// ============================================
// API –ó–ê–ü–†–û–° –° –û–ë–†–ê–ë–û–¢–ö–û–ô –û–®–ò–ë–û–ö
// ============================================

// TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –≤—Å–µ –Ω—É–∂–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –∏–∑ './errors.js'

const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á';
const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

// TODO: –°–æ–∑–¥–∞–π –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π async —Ñ—É–Ω–∫—Ü–∏—é getWeather(city)
// 1. –û–±–µ—Ä–Ω–∏ –≤ try-catch
// 2. –í try:
//    - const response = await fetch(`${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`)
//    - if (response.status === 404) throw new CityNotFoundError(city)
//    - if (response.status === 401) throw new InvalidAPIKeyError()
//    - if (response.status === 429) throw new RateLimitError()
//    - if (!response.ok) throw new WeatherAPIError('–û—à–∏–±–∫–∞ API', response.status)
//    - return await response.json()
// 3. –í catch:
//    - if (error.name === 'TypeError') throw new NetworkError()
//    - throw error

// TODO: –°–æ–∑–¥–∞–π –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π async —Ñ—É–Ω–∫—Ü–∏—é retryWithBackoff(fn, maxRetries = 2)
// 1. for (let attempt = 0; attempt <= maxRetries; attempt++)
// 2. try {
//      return await fn();
//    }
// 3. catch (error) {
//      const shouldRetry = error instanceof NetworkError;
//      if (attempt === maxRetries || !shouldRetry) throw error;
//      const delay = 1000 * Math.pow(2, attempt);
//      await new Promise(r => setTimeout(r, delay));
//    }
```

**modules/cache.js**
```javascript
// ============================================
// –ö–≠–®–ò–†–û–í–ê–ù–ò–ï
// ============================================

const cache = new Map();

// TODO: –°–æ–∑–¥–∞–π –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π —Ñ—É–Ω–∫—Ü–∏—é getCached(city)
// return cache.get(city.toLowerCase())

// TODO: –°–æ–∑–¥–∞–π –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π —Ñ—É–Ω–∫—Ü–∏—é setCache(city, data)
// cache.set(city.toLowerCase(), data)
```

**modules/ui.js**
```javascript
// ============================================
// UI –§–£–ù–ö–¶–ò–ò
// ============================================

// TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –Ω—É–∂–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –∏–∑ './errors.js'

// TODO: –°–æ–∑–¥–∞–π –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π —Ñ—É–Ω–∫—Ü–∏—é showError(error)
// 1. const container = document.getElementById('errorContainer')
// 2. –û–ø—Ä–µ–¥–µ–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: let errorClass, message, showRetry = false
// 3. –ü—Ä–æ–≤–µ—Ä—å —Ç–∏–ø—ã –æ—à–∏–±–æ–∫:
//    if (error instanceof NetworkError) {
//      errorClass = 'network';
//      message = '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É';
//      showRetry = true;
//    } else if (error instanceof CityNotFoundError) {
//      errorClass = 'not-found';
//      message = `–ì–æ—Ä–æ–¥ "${error.city}" –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.`;
//    } else {
//      errorClass = 'validation';
//      message = error.message;
//    }
// 4. container.innerHTML = `
//      <div class="error ${errorClass}">
//        ‚ùå ${message}
//        ${showRetry ? '<button class="retry-btn" onclick="retrySearch()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>' : ''}
//      </div>
//    `;

// TODO: –°–æ–∑–¥–∞–π –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π —Ñ—É–Ω–∫—Ü–∏—é showWeather(data, fromCache = false)
// 1. const weatherInfo = document.getElementById('weatherInfo')
// 2. weatherInfo.innerHTML = `
//      <h2>${data.name}, ${data.sys.country}</h2>
//      <div style="font-size: 48px;">${Math.round(data.main.temp)}¬∞C</div>
//      <p>${data.weather[0].description}</p>
//      ${fromCache ? '<div class="cached-indicator">üì¶ –î–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞</div>' : ''}
//    `;
// 3. document.getElementById('errorContainer').innerHTML = '';
```

**app.js**
```javascript
// ============================================
// –ì–õ–ê–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
// ============================================

// TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –º–æ–¥—É–ª–µ–π:
// - validateCityInput –∏–∑ './modules/validation.js'
// - getWeather, retryWithBackoff –∏–∑ './modules/api.js'
// - getCached, setCache –∏–∑ './modules/cache.js'
// - showError, showWeather –∏–∑ './modules/ui.js'

// TODO: –°–æ–∑–¥–∞–π async —Ñ—É–Ω–∫—Ü–∏—é searchWeather()
// 1. const input = document.getElementById('cityInput').value
// 2. –û–±–µ—Ä–Ω–∏ –≤ try-catch
// 3. –í try:
//    - const city = validateCityInput(input)
//    - const weather = await retryWithBackoff(() => getWeather(city))
//    - setCache(city, weather)
//    - showWeather(weather)
// 4. –í catch (graceful degradation):
//    - const cached = getCached(input)
//    - if (cached) {
//        showWeather(cached, true);  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—ç—à
//        showError(error);            // –Ω–æ –∏ –æ—à–∏–±–∫—É —Ç–æ–∂–µ
//      } else {
//        showError(error);
//      }

// TODO: –î–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
// document.getElementById('searchBtn').addEventListener('click', searchWeather)
// document.getElementById('cityInput').addEventListener('keypress', (e) => {
//   if (e.key === 'Enter') searchWeather();
// })

// TODO: –°–æ–∑–¥–∞–π –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∫–Ω–æ–ø–∫–∏ retry
// window.retrySearch = searchWeather;

// TODO: –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
// document.getElementById('cityInput').value = 'Moscow';
// searchWeather();
```


<details>
<summary>–ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ</summary>

**index.html**
```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–∞–¥—ë–∂–Ω–æ–µ –ø–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .weather-card {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    input {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      width: 70%;
      font-size: 16px;
    }
    button {
      padding: 12px 24px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-left: 10px;
    }
    button:hover {
      background: #0056b3;
    }
    .error {
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .error.validation {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      color: #856404;
    }
    .error.network {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
      color: #721c24;
    }
    .error.not-found {
      background: #d1ecf1;
      border-left: 4px solid #17a2b8;
      color: #0c5460;
    }
    .retry-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    .cached-indicator {
      background: #d4edda;
      color: #155724;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 10px;
    }
    #weatherInfo {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="weather-card">
    <h1>üå§Ô∏è –ù–∞–¥—ë–∂–Ω–∞—è –ø–æ–≥–æ–¥–∞</h1>

    <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥...">
    <button id="searchBtn">–ü–æ–∏—Å–∫</button>

    <div id="errorContainer"></div>
    <div id="weatherInfo"></div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
```

**modules/errors.js**
```javascript
// –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è API –æ—à–∏–±–æ–∫
export class WeatherAPIError extends Error {
  constructor(message, statusCode) {
    super(message);
    this.name = 'WeatherAPIError';
    this.statusCode = statusCode;
  }
}

// –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
export class CityNotFoundError extends WeatherAPIError {
  constructor(city) {
    super(`–ì–æ—Ä–æ–¥ "${city}" –Ω–µ –Ω–∞–π–¥–µ–Ω`, 404);
    this.name = 'CityNotFoundError';
    this.city = city;
  }
}

// –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞
export class NetworkError extends Error {
  constructor() {
    super('–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
    this.name = 'NetworkError';
  }
}

// –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
export class InputValidationError extends Error {
  constructor(message) {
    super(message);
    this.name = 'InputValidationError';
  }
}

// –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
export class InvalidAPIKeyError extends WeatherAPIError {
  constructor() {
    super('–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á', 401);
    this.name = 'InvalidAPIKeyError';
  }
}

// –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
export class RateLimitError extends WeatherAPIError {
  constructor() {
    super('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤', 429);
    this.name = 'RateLimitError';
  }
}
```

**modules/validation.js**
```javascript
import { InputValidationError } from './errors.js';

export function validateCityInput(city) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É
  if (!city || city.trim() === '') {
    throw new InputValidationError('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞');
  }

  const trimmed = city.trim();

  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞
  if (trimmed.length < 2) {
    throw new InputValidationError('–ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
  }

  // –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å—ã, –∞–ø–æ—Å—Ç—Ä–æ—Ñ—ã
  if (!/^[\p{L}\s\-']+$/u.test(trimmed)) {
    throw new InputValidationError('–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã');
  }

  return trimmed;
}
```

**modules/api.js**
```javascript
import {
  WeatherAPIError,
  CityNotFoundError,
  NetworkError,
  InvalidAPIKeyError,
  RateLimitError
} from './errors.js';

const API_KEY = '—Ç–≤–æ–π_api_–∫–ª—é—á';
const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

export async function getWeather(city) {
  try {
    const response = await fetch(
      `${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ru`
    );

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–æ–≤
    if (response.status === 404) {
      throw new CityNotFoundError(city);
    }

    if (response.status === 401) {
      throw new InvalidAPIKeyError();
    }

    if (response.status === 429) {
      throw new RateLimitError();
    }

    if (!response.ok) {
      throw new WeatherAPIError('–û—à–∏–±–∫–∞ API', response.status);
    }

    return await response.json();

  } catch (error) {
    // TypeError = —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ (–Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, DNS –∏ —Ç.–¥.)
    if (error.name === 'TypeError') {
      throw new NetworkError();
    }
    throw error;
  }
}

export async function retryWithBackoff(fn, maxRetries = 2) {
  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      // –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
      const shouldRetry = error instanceof NetworkError;

      // –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –∏–ª–∏ –Ω–µ —Å—Ç–æ–∏—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å
      if (attempt === maxRetries || !shouldRetry) {
        throw error;
      }

      // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 1s, 2s, 4s...
      const delay = 1000 * Math.pow(2, attempt);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}
```

**modules/cache.js**
```javascript
const cache = new Map();

export function getCached(city) {
  return cache.get(city.toLowerCase());
}

export function setCache(city, data) {
  cache.set(city.toLowerCase(), data);
}
```

**modules/ui.js**
```javascript
import {
  NetworkError,
  CityNotFoundError,
  InvalidAPIKeyError
} from './errors.js';

export function showError(error) {
  const container = document.getElementById('errorContainer');

  let errorClass = 'validation';
  let message = error.message;
  let showRetry = false;

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è
  if (error instanceof NetworkError) {
    errorClass = 'network';
    message = '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.';
    showRetry = true;
  } else if (error instanceof CityNotFoundError) {
    errorClass = 'not-found';
    message = `–ì–æ—Ä–æ–¥ "${error.city}" –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.`;
  } else if (error instanceof InvalidAPIKeyError) {
    errorClass = 'validation';
    message = '–û—à–∏–±–∫–∞ API –∫–ª—é—á–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.';
  }

  container.innerHTML = `
    <div class="error ${errorClass}">
      ‚ùå ${message}
      ${showRetry ? '<button class="retry-btn" onclick="retrySearch()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>' : ''}
    </div>
  `;
}

export function showWeather(data, fromCache = false) {
  const weatherInfo = document.getElementById('weatherInfo');

  weatherInfo.innerHTML = `
    <h2>${data.name}, ${data.sys.country}</h2>
    <div style="font-size: 48px;">${Math.round(data.main.temp)}¬∞C</div>
    <p>${data.weather[0].description}</p>
    ${fromCache ? '<div class="cached-indicator">üì¶ –î–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ (–æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º)</div>' : ''}
  `;

  document.getElementById('errorContainer').innerHTML = '';
}
```

**app.js**
```javascript
import { validateCityInput } from './modules/validation.js';
import { getWeather, retryWithBackoff } from './modules/api.js';
import { getCached, setCache } from './modules/cache.js';
import { showError, showWeather } from './modules/ui.js';

async function searchWeather() {
  const input = document.getElementById('cityInput').value;

  try {
    // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è
    const city = validateCityInput(input);

    // 2. –ó–∞–ø—Ä–æ—Å —Å retry
    const weather = await retryWithBackoff(() => getWeather(city));

    // 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    setCache(city, weather);

    // 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    showWeather(weather);

  } catch (error) {
    // Graceful degradation: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—ç—à –µ—Å–ª–∏ –µ—Å—Ç—å
    const cached = getCached(input);

    if (cached) {
      showWeather(cached, true);  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—ç—à
      showError(error);            // –Ω–æ —É–≤–µ–¥–æ–º–ª—è–µ–º –æ–± –æ—à–∏–±–∫–µ
    } else {
      showError(error);
    }
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
document.getElementById('searchBtn').addEventListener('click', searchWeather);

document.getElementById('cityInput').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    searchWeather();
  }
});

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ retry
window.retrySearch = searchWeather;

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
document.getElementById('cityInput').value = 'Moscow';
searchWeather();
```

### ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (6 –º–æ–¥—É–ª–µ–π)
- ‚úÖ –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ —Å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å regex –¥–ª—è Unicode –±—É–∫–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ (404, 401, 429, 5xx, network)
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è graceful degradation
- ‚úÖ –†–∞–∑–Ω—ã–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—à–∏–±–æ–∫
- ‚úÖ –ö–Ω–æ–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞ –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º —Å –∫—ç—à–µ–º

</details>


---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–π —Ç–µ–º—ã —Ç—ã –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å:

- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å try/catch/finally –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- [ ] –°–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫
- [ ] –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ throw
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –ø—Ä–æ–º–∏—Å–∞—Ö (.catch)
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ async/await
- [ ] –†–∞–∑–ª–∏—á–∞—Ç—å —Ç–∏–ø—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
- [ ] –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏ –æ—à–∏–±–∫–∏ API
- [ ] –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º—ã
- [ ] –ü—Ä–∏–º–µ–Ω—è—Ç—å graceful degradation

---

## üîó –†–µ—Å—É—Ä—Å—ã

**–°—Ç–∞—Ç—å–∏:**
- [Error handling ‚Äî JavaScript.ru](https://learn.javascript.ru/try-catch)
- [MDN: Error](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Error)
- [Custom errors ‚Äî JavaScript.info](https://javascript.info/custom-errors)

**–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:**
- [Error handling in async/await](https://javascript.info/async-await#error-handling)
- [MDN: Control flow and error handling](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Control_flow_and_error_handling)

**–í–∏–¥–µ–æ:**
- [try catch finally, throw, –∫–ª–∞—Å—Å Error ‚Äî –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –õ–∞–º–∫–æ–≤](https://www.youtube.com/watch?v=ubYPpR9acQc)
- [JavaScript Error Handling ‚Äî Web Dev Simplified](https://www.youtube.com/watch?v=cFTFtuEQ-10)

---

‚è± **–í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ**: 3-4 —á–∞—Å–∞

---

**–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Ç–µ–º–∞:** [2.2.6 –ú–æ–¥—É–ª–∏ (ES6+)](./2.2.6-–ú–æ–¥—É–ª–∏.md)

**–°–ª–µ–¥—É—é—â–∞—è —Ç–µ–º–∞:** [2.3.1 –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](./2.3.1-–ü–∞—Ç—Ç–µ—Ä–Ω—ã-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.md)
